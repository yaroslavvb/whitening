(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     75274,       1902]
NotebookOptionsPosition[     73473,       1833]
NotebookOutlinePosition[     73833,       1849]
CellTagsIndexPosition[     73790,       1846]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Natural gradient for multilayer linear nets", "Title",
 CellChangeTimes->{{3.699982030861434*^9, 3.699982042951764*^9}}],

Cell["Util", "Section",
 CellChangeTimes->{{3.699993495651449*^9, 3.699993502401659*^9}}],

Cell[CellGroupData[{

Cell["Main", "Section",
 CellChangeTimes->{{3.699993508701356*^9, 3.699993514326229*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Notation", ":", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"error", " ", "is", " ", "Y"}], "-", 
        RowBox[{"W", "[", "n", "]"}]}], "..."}], ".", 
      RowBox[{"W", "[", "1", "]"}], ".", 
      RowBox[{"W", "[", "0", "]"}]}]}], "=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Y", "-", 
         RowBox[{"W", "[", "n", "]"}]}], "..."}], ".."}], 
      RowBox[{
       RowBox[{"W", "[", "1", "]"}], ".", "X"}], "\[IndentingNewLine]", "Wi", 
      " ", "has", " ", "size", " ", 
      RowBox[{"f", "[", "i", "]"}], " ", "x", " ", 
      RowBox[{"f", "[", 
       RowBox[{"i", "-", "1"}], "]"}], "\[IndentingNewLine]", "Y", " ", "has",
       " ", "size", " ", 
      RowBox[{"f", "[", "n", "]"}], " ", "x", " ", 
      RowBox[{"f", "[", 
       RowBox[{"-", "1"}], "]"}], "\[IndentingNewLine]", "X", " ", "has", " ",
       "size", " ", 
      RowBox[{"f", "[", "0", "]"}], " ", "x", " ", 
      RowBox[{"f", "[", 
       RowBox[{"-", "1"}], "]"}], "\[IndentingNewLine]", "fs"}], "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"-", "1"}], "]"}], ",", 
       RowBox[{"f", "[", "0", "]"}], ",", 
       RowBox[{"f", "[", "1", "]"}], ",", "...", ",", 
       RowBox[{"f", "[", "n", "]"}]}], "}"}]}]}], "\[IndentingNewLine]", " ", 
   "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "W", ",", "X", ",", "Y", ",", "y", ",", "x", ",", "fs", ",", " ", 
      "subW"}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Ws", " ", "gives", " ", "list", " ", "of", " ", "matrices"}], 
     ",", " ", 
     RowBox[{"Wf", " ", "means", " ", "flattened", " ", "representation"}]}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "Wf", " ", "gives", " ", "list", " ", "of", " ", "symbolic", " ", 
      "variables"}], ",", " ", 
     RowBox[{"W0f", " ", "gives", " ", "concrete", " ", "values"}]}], " ", 
    "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"On", "[", "Assert", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SeedRandom", "[", "0", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"fs", "=", 
     RowBox[{"{", 
      RowBox[{"10", ",", "2", ",", "2", ",", "2", ",", "1"}], "}"}]}], " ", 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dsize", "=", 
     RowBox[{"First", "[", "fs", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "number", " ", "of", " ", "layers", " ", "aka", " ", "number", " ", "of", 
     " ", "matmuls"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"n", "=", 
     RowBox[{
      RowBox[{"Length", "[", "fs", "]"}], "-", "2"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dsize", "=", 
     RowBox[{"First", "@", "fs"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"makeW", "[", "0", "]"}], " ", "is", " ", "X"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeW", "[", "k_", "]"}], ":=", 
     RowBox[{"Array", "[", 
      RowBox[{
       RowBox[{"W", "[", "k", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"fs", "[", 
          RowBox[{"[", 
           RowBox[{"k", "+", "2"}], "]"}], "]"}], ",", 
         RowBox[{"fs", "[", 
          RowBox[{"[", 
           RowBox[{"k", "+", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeInitializer", "[", "k_", "]"}], ":=", 
     RowBox[{"RandomReal", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"fs", "[", 
          RowBox[{"[", 
           RowBox[{"k", "+", "2"}], "]"}], "]"}], ",", 
         RowBox[{"fs", "[", 
          RowBox[{"[", 
           RowBox[{"k", "+", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"vars", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"makeW", "[", "k", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", "1", ",", "n"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Ws", "=", "vars"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"varsf", "=", 
     RowBox[{"Flatten", "[", 
      RowBox[{"vectorize", "/@", "vars"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Wf", "=", "varsf"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"W0", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"makeInitializer", "[", "k", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", "1", ",", "n"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"W", " ", "true", " ", "flat"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Wtf", "=", 
     RowBox[{"{", 
      RowBox[{
      "0.8062349520611257`", ",", "0.8058281619635977`", ",", 
       "0.8373291816030192`", ",", "0.7906864569952768`", ",", 
       "1.1965576018047888`", ",", "0.30483187178626686`", ",", 
       "1.2476949293612638`", ",", "0.8154112123212373`", ",", 
       "0.12928385363990855`", ",", "0.8254921329944452`"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"W0", " ", "flat"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"W0f", "=", 
     RowBox[{"Flatten", "[", 
      RowBox[{"vectorize", "/@", "W0"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Y", "-", "Wn"}], "..."}], ".", "W1", ".", "W0"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"errEq", ":=", 
     RowBox[{"Y", "-", 
      RowBox[{
       RowBox[{"Fold", "[", 
        RowBox[{"Dot", ",", 
         RowBox[{"Reverse", "@", "vars"}]}], "]"}], ".", 
       RowBox[{"makeW", "[", "0", "]"}]}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lossEq", ":=", 
     RowBox[{"take1", "[", 
      RowBox[{
       FractionBox["1", 
        RowBox[{"2", " ", "dsize"}]], 
       RowBox[{"errEq", ".", 
        RowBox[{"errEq", "\[Transpose]"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"subW", "[", "Wf_", "]"}], ":=", 
     RowBox[{"Thread", "[", 
      RowBox[{"varsf", "\[Rule]", "Wf"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"X", "=", 
     RowBox[{"Array", "[", 
      RowBox[{
       RowBox[{"W", "[", "0", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"fs", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", 
         RowBox[{"fs", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"X0", "=", 
     RowBox[{"RandomReal", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"fs", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", 
         RowBox[{"fs", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"subX", ":=", 
     RowBox[{"(", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Assert", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Dimensions", "[", "X0", "]"}], "\[Equal]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"fs", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", 
            RowBox[{"fs", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], ",", 
         "\"\<X mismatch\>\""}], "]"}], ";", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"Flatten", "@", "X"}], "\[Rule]", 
         RowBox[{"Flatten", "@", "X0"}]}], "]"}]}], "\[IndentingNewLine]", 
      ")"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Y", "=", 
     RowBox[{"Array", "[", 
      RowBox[{"y", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"fs", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}], ",", 
         RowBox[{"fs", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Y0", "=", 
     RowBox[{"RandomReal", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"fs", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}], ",", 
         RowBox[{"fs", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"subY", ":=", 
     RowBox[{"(", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Assert", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Dimensions", "[", "Y0", "]"}], "\[Equal]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Last", "[", "fs", "]"}], ",", " ", 
            RowBox[{"First", "[", "fs", "]"}]}], "}"}]}], ",", 
         "\"\<Y mismatch\>\""}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"Flatten", "@", "Y"}], "\[Rule]", 
         RowBox[{"Flatten", "@", "Y0"}]}], "]"}]}], "\[IndentingNewLine]", 
      ")"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"X0", ",", "Y0", ",", "dummy"}], "}"}], "=", 
     RowBox[{"generateXY", "[", 
      RowBox[{"0.01", ",", "1.", ",", "0", ",", 
       RowBox[{"First", "@", "fs"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"flatten", "[", "Ws_", "]"}], ":=", 
     RowBox[{"c2v", "[", 
      RowBox[{"vectorize", "/@", "Ws"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"unflatten", "[", "Wf_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"sizes", "=", 
         RowBox[{"Rest", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Times", "@@", "#"}], "&"}], "/@", 
           RowBox[{"Partition", "[", 
            RowBox[{"fs", ",", "2", ",", "1"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"flatVars", "=", 
         RowBox[{"listPartition", "[", 
          RowBox[{"Wf", ",", "sizes"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"unvectorize", "[", 
           RowBox[{
            RowBox[{"flatVars", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ",", 
            RowBox[{"fs", "[", 
             RowBox[{"[", 
              RowBox[{"i", "+", "2"}], "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "@", "sizes"}]}], "}"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Define", " ", "loss"}], ",", " ", "gradient", ",", " ", 
     "Hessian"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"lossf", "[", "Wf_", "]"}], ":=", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"lossEq", "/.", 
         RowBox[{"subW", "[", "Wf", "]"}]}], "/.", "subY"}], "/.", "subX"}], 
      ")"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"loss", "[", "Ws_", "]"}], ":=", 
     RowBox[{"lossf", "[", 
      RowBox[{"flatten", "[", "Ws", "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Assert", "[", 
     RowBox[{
      RowBox[{"vars", "\[Equal]", 
       RowBox[{"unflatten", "[", "varsf", "]"}]}], ",", 
      "\"\<vars mismatch\>\""}], "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"gradEq", "=", 
     RowBox[{"D", "[", 
      RowBox[{
       RowBox[{"lossf", "[", "Wf", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"Wf", ",", "1"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"hessEq", "=", 
     RowBox[{"D", "[", 
      RowBox[{
       RowBox[{"lossf", "[", "Wf", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"Wf", ",", "2"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"gradf", "[", "Wf_", "]"}], ":=", 
     RowBox[{"gradEq", "/.", 
      RowBox[{"subW", "[", "Wf", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"hessf", "[", "Wf_", "]"}], ":=", 
     RowBox[{"hessEq", "/.", 
      RowBox[{"subW", "[", "Wf", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ihessf", "[", "Wf_", "]"}], ":=", 
     RowBox[{"PseudoInverse", "[", 
      RowBox[{"hessf", "[", "Wf", "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Manual", " ", "implementation", " ", "of", " ", "gradient"}], 
    " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"A", "[", "i", "]"}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"W", "[", 
         RowBox[{"i", "-", "1"}], "]"}], "..."}], 
       RowBox[{"W", "[", "0", "]"}]}], " ", "=", " ", 
      RowBox[{
      "fprop", " ", "needed", " ", "to", " ", "compute", " ", "derivative", 
       " ", "at", " ", "layer", " ", "i"}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"A", "[", 
      RowBox[{"Wf_", ",", "1"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"makeW", "[", "0", "]"}], "/.", "subX"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"A", "[", 
      RowBox[{"Wf_", ",", "i_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"makeW", "[", 
          RowBox[{"i", "-", "1"}], "]"}], ".", 
         RowBox[{"A", "[", 
          RowBox[{"Wf", ",", 
           RowBox[{"i", "-", "1"}]}], "]"}]}], "/.", 
        RowBox[{"subW", "[", "Wf", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"B", "[", "i", "]"}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"W", "[", 
          RowBox[{"i", "+", "1"}], "]"}], "'"}], "..."}], "err"}], " ", "=", 
      " ", 
      RowBox[{
      "bprop", " ", "needed", " ", "to", " ", "compute", " ", "derivative", 
       " ", "at", " ", "layer", " ", "i"}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"err", "[", "Ws_", "]"}], ":=", 
     RowBox[{
      RowBox[{"Y", "-", 
       RowBox[{"A", "[", 
        RowBox[{
         RowBox[{"flatten", "@", "Ws"}], ",", 
         RowBox[{"n", "+", "1"}]}], "]"}]}], "/.", "subY"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"B", "[", 
      RowBox[{"Wf_", ",", "n"}], "]"}], ":=", 
     RowBox[{"err", "[", 
      RowBox[{"unflatten", "[", "Wf", "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"B", "[", 
      RowBox[{"Wf_", ",", "i_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"makeW", "[", 
           RowBox[{"i", "+", "1"}], "]"}], "\[Transpose]"}], ".", 
         RowBox[{"B", "[", 
          RowBox[{"Wf", ",", 
           RowBox[{"i", "+", "1"}]}], "]"}]}], "/.", 
        RowBox[{"subW", "[", "Wf", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dW", "[", 
      RowBox[{"Wf_", ",", "i_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"-", 
       RowBox[{
        RowBox[{"B", "[", 
         RowBox[{"Wf", ",", "i"}], "]"}], ".", 
        RowBox[{
         RowBox[{"A", "[", 
          RowBox[{"Wf", ",", "i"}], "]"}], "\[Transpose]"}]}]}], "/", 
      "dsize"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"Assert", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"gradf", "[", "W0f", "]"}], "==", 
      RowBox[{"flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"dW", "[", 
          RowBox[{"W0f", ",", "#"}], "]"}], "&"}], "/@", 
        RowBox[{"Range", "[", "n", "]"}]}], "]"}]}], ",", " ", 
     "\"\<Gradient incorrect\>\""}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.699982156807973*^9, 3.699982598214026*^9}, {
   3.6999826448060083`*^9, 3.6999826780909157`*^9}, {3.6999827216386127`*^9, 
   3.699982733320653*^9}, {3.699982914162751*^9, 3.699982941265422*^9}, {
   3.6999830257195797`*^9, 3.699983050992374*^9}, {3.699983224842721*^9, 
   3.699983310463262*^9}, {3.6999834195148563`*^9, 3.699983477039249*^9}, {
   3.699983587021646*^9, 3.6999835986448107`*^9}, {3.699983695110857*^9, 
   3.699983695349987*^9}, {3.699983748675165*^9, 3.6999837487802362`*^9}, {
   3.699983928707264*^9, 3.699983967510991*^9}, {3.699984047267655*^9, 
   3.6999840496660757`*^9}, {3.699985530553913*^9, 3.6999855458395042`*^9}, {
   3.699985913673225*^9, 3.699985969156344*^9}, {3.6999861003176413`*^9, 
   3.699986124454165*^9}, {3.699986355753088*^9, 3.699986396898237*^9}, {
   3.699986427650106*^9, 3.699986703287118*^9}, {3.699986754544344*^9, 
   3.6999867556102962`*^9}, {3.69998681994671*^9, 3.699986848372896*^9}, {
   3.699986892410982*^9, 3.699986893640285*^9}, {3.69998693003189*^9, 
   3.6999869570766*^9}, {3.6999870083330517`*^9, 3.699987068617716*^9}, {
   3.699987348308199*^9, 3.699987351371369*^9}, {3.699987415851831*^9, 
   3.699987416542459*^9}, {3.699987447054257*^9, 3.699987455017548*^9}, {
   3.69998755080951*^9, 3.6999875855353603`*^9}, {3.6999931554263773`*^9, 
   3.699993170663336*^9}, {3.699993203366107*^9, 3.69999320382825*^9}, {
   3.699993393086769*^9, 3.6999934430810833`*^9}, {3.699993484708765*^9, 
   3.699993485815668*^9}, {3.699993897808597*^9, 3.699993942358086*^9}, {
   3.699993998113549*^9, 3.6999940446577997`*^9}, {3.699994331070149*^9, 
   3.699994432768942*^9}, 3.69999451083252*^9, {3.699995021164749*^9, 
   3.699995041908965*^9}, {3.699995100933156*^9, 3.6999951103670893`*^9}, {
   3.6999952576223583`*^9, 3.699995257756886*^9}, {3.6999963660691767`*^9, 
   3.6999963666670017`*^9}, {3.699996480759503*^9, 3.6999965061522512`*^9}, 
   3.699996618534986*^9, {3.699998381714772*^9, 3.699998381848865*^9}, {
   3.699998415403894*^9, 3.699998420622656*^9}, {3.699998459911641*^9, 
   3.699998481132703*^9}, {3.699998702072735*^9, 3.6999987147901154`*^9}, {
   3.699998758951478*^9, 3.6999987598495913`*^9}, {3.700048600925748*^9, 
   3.7000486062226753`*^9}, {3.700055975452201*^9, 3.700056166226185*^9}, {
   3.700057412005982*^9, 3.70005747468043*^9}, {3.700057506009913*^9, 
   3.700057512710882*^9}, {3.700057580611055*^9, 3.700057584145731*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Newton Method", "Section",
 CellChangeTimes->{{3.699993645733891*^9, 3.699993650072628*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{"pointList", ",", "gradList", ",", "preList", ",", "lossList"}], 
    "]"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"takes", " ", "loss"}], ",", " ", "grad", ",", " ", 
    RowBox[{"learning", " ", "rate"}], ",", " ", 
    RowBox[{"produces", " ", "list", " ", "of", " ", "losses"}]}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"globals", ":", " ", "points"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"optimizeNewton", "[", 
    RowBox[{"lr_", ",", "w0f_", ",", "iters_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "wf", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pointList", ",", " ", "gradList", ",", "preList", ",", " ", 
         "lossList"}], "}"}], "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", "}"}], ",", 
         RowBox[{"{", "}"}], ",", 
         RowBox[{"{", "}"}], ",", 
         RowBox[{"{", "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wf", "=", "w0f"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"iter", "=", "1"}], ",", 
        RowBox[{"iter", "\[LessEqual]", "iters"}], ",", 
        RowBox[{"iter", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"pointList", "=", 
          RowBox[{"pointList", "~", "Append", "~", "wf"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"gradList", "=", 
          RowBox[{"gradList", "~", "Append", "~", 
           RowBox[{"gradf", "[", "wf", "]"}]}]}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"preList", "=", 
          RowBox[{"preList", "~", "Append", "~", 
           RowBox[{"ihessf", "[", "wf", "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"lossList", "=", 
          RowBox[{"lossList", "~", "Append", "~", 
           RowBox[{"lossf", "[", "wf", "]"}]}]}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"wf", "=", 
          RowBox[{"wf", "-", 
           RowBox[{"lr", "*", 
            RowBox[{
             RowBox[{"gradf", "[", "wf", "]"}], ".", 
             RowBox[{"ihessf", "[", "wf", "]"}]}]}]}]}]}]}], 
       "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{
  3.6999936898161488`*^9, {3.69999466562971*^9, 3.699994672229844*^9}, {
   3.6999949807219954`*^9, 3.699995007660274*^9}, {3.6999950594576387`*^9, 
   3.699995152141176*^9}, {3.699996346177471*^9, 3.6999963465813847`*^9}, {
   3.69999850948297*^9, 3.6999985170439663`*^9}, {3.69999855772528*^9, 
   3.699998580839075*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"optimizeNewton", "[", 
   RowBox[{"1.", ",", "W0f", ",", "20"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"ListPlot", "[", "lossList", "]"}]}], "Input",
 CellChangeTimes->{{3.699996395704974*^9, 3.699996417545793*^9}, {
  3.699998522516466*^9, 3.699998538987547*^9}, {3.6999987749703493`*^9, 
  3.6999987753886003`*^9}, {3.7000561981753407`*^9, 3.700056198773717*^9}}],

Cell[BoxData[
 GraphicsBox[{{}, {{}, 
    {RGBColor[0.368417, 0.506779, 0.709798], PointSize[0.012833333333333334`],
      AbsoluteThickness[1.6], PointBox[CompressedData["
1:eJxTTMoPSmViYGAQAWIQDQEf7LuME2vrTK/ZQwUclpt9z6jLM3eAcDkcvk8W
tfZfJQLlCzgsUFM9xiHyAapexGHW9TuC04tPQfkSDiXBAZIMvruhfBkHHdsd
udm6u6B8BYcKT36FIB0YX8nBZPEeOQRfBY2vhsbXQONrofF10Ph6aHwDNL4h
Gt/IwRSFb4wmbwLnAwAKsUm3
      "]]}, {}}, {}, {}, {{}, {}}},
  AspectRatio->NCache[GoldenRatio^(-1), 0.6180339887498948],
  Axes->{True, True},
  AxesLabel->{None, None},
  AxesOrigin->{0., 0},
  DisplayFunction->Identity,
  Frame->{{False, False}, {False, False}},
  FrameLabel->{{None, None}, {None, None}},
  FrameTicks->{{Automatic, Automatic}, {Automatic, Automatic}},
  GridLines->{None, None},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImagePadding->All,
  Method->{"CoordinatesToolOptions" -> {"DisplayFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& ), "CopiedValueFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& )}},
  PlotRange->{{0., 20.}, {0, 0.7141793797937289}},
  PlotRangeClipping->True,
  PlotRangePadding->{{
     Scaled[0.02], 
     Scaled[0.02]}, {
     Scaled[0.02], 
     Scaled[0.05]}},
  Ticks->{Automatic, Automatic}]], "Output",
 CellChangeTimes->{
  3.699996417950671*^9, 3.699998309498437*^9, {3.699998523896056*^9, 
   3.69999853939727*^9}, 3.699998582233848*^9, 3.699998727912715*^9, {
   3.699998767431377*^9, 3.69999877687151*^9}, 3.700048580115987*^9, {
   3.700056194173472*^9, 3.7000562002548113`*^9}, 3.7000575903698378`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Natural Gradient Method", "Section",
 CellChangeTimes->{{3.699996377424655*^9, 3.699996383314393*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"get", " ", "single", " ", "X"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"makeX1", "[", "i_", "]"}], ":=", 
     RowBox[{"v2c", "[", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"W", "[", "0", "]"}], "[", 
         RowBox[{"j", ",", "i"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", 
          RowBox[{"fs", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Assert", "[", 
     RowBox[{
      RowBox[{"Join", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"makeX1", "[", "i", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "10"}], "}"}]}], "]"}], "~", "Join", "~", 
         RowBox[{"{", "2", "}"}]}], ")"}]}], "\[Equal]", 
      RowBox[{"makeW", "[", "0", "]"}]}], "]"}], ";"}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeY1", "[", "i_", "]"}], ":=", 
     RowBox[{"Y", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "i"}], "]"}], "]"}]}], ";", 
    RowBox[{
     RowBox[{"errEq1", "[", "i_", "]"}], ":=", 
     RowBox[{
      RowBox[{"makeY1", "[", "i", "]"}], "-", 
      RowBox[{
       RowBox[{"Fold", "[", 
        RowBox[{"Dot", ",", 
         RowBox[{"Reverse", "@", "vars"}]}], "]"}], ".", 
       RowBox[{"makeX1", "[", "i", "]"}]}]}]}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{
     RowBox[{"lossEq1", "[", "i_", "]"}], ":=", 
     RowBox[{"(", 
      RowBox[{"take1", "[", 
       RowBox[{
        FractionBox["1", 
         RowBox[{"2", " ", "dsize"}]], 
        RowBox[{
         RowBox[{"errEq1", "[", "i", "]"}], ".", 
         RowBox[{
          RowBox[{"errEq1", "[", "i", "]"}], "\[Transpose]"}]}]}], "]"}], 
      ")"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"lossf1", "[", 
      RowBox[{"Wf_", ",", "i_"}], "]"}], ":=", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"lossEq1", "[", "i", "]"}], "/.", 
         RowBox[{"subW", "[", "Wf", "]"}]}], "/.", "subY"}], "/.", "subX"}], 
      ")"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"gradEq1", "[", "i_", "]"}], ":=", 
     RowBox[{"D", "[", 
      RowBox[{
       RowBox[{"lossf1", "[", 
        RowBox[{"Wf", ",", "i"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"Wf", ",", "1"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"gradf1", "[", 
      RowBox[{"Wf_", ",", "i_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"gradEq1", "[", "i", "]"}], "/.", 
      RowBox[{"subW", "[", "Wf", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"fisher", "[", "Wf_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"dsize", " ", "x", " ", "fsize"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"gradList", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"gradf1", "[", 
            RowBox[{"Wf", ",", "i"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"First", "[", "fs", "]"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"gradList", "\[Transpose]"}], ".", "gradList"}], "/", 
         "dsize"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ifisher", "[", "Wf_", "]"}], ":=", 
     RowBox[{"PseudoInverse", "[", 
      RowBox[{"fisher", "[", "Wf", "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"optimizeNatural", "[", 
      RowBox[{"lr_", ",", "w0f_", ",", "iters_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "wf", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "pointList", ",", " ", "gradList", ",", "preList", ",", " ", 
           "lossList", ",", "temp"}], "}"}], "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", "}"}], ",", 
           RowBox[{"{", "}"}], ",", 
           RowBox[{"{", "}"}], ",", 
           RowBox[{"{", "}"}], ",", 
           RowBox[{"{", "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"wf", "=", "w0f"}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"iter", "=", "1"}], ",", 
          RowBox[{"iter", "\[LessEqual]", "iters"}], ",", 
          RowBox[{"iter", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"pointList", "=", 
            RowBox[{"pointList", "~", "Append", "~", "wf"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"gradList", "=", 
            RowBox[{"gradList", "~", "Append", "~", 
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{"gradf", "[", "wf", "]"}], "}"}], "}"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"temp", "=", 
            RowBox[{"temp", "~", "Append", "~", 
             RowBox[{"gradf", "[", "wf", "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"preList", "=", 
            RowBox[{"preList", "~", "Append", "~", 
             RowBox[{"ihessf", "[", "wf", "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"lossList", "=", 
            RowBox[{"lossList", "~", "Append", "~", 
             RowBox[{"lossf", "[", "wf", "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"wf", "=", 
            RowBox[{"wf", "-", 
             RowBox[{"lr", "*", 
              RowBox[{
               RowBox[{"gradf", "[", "wf", "]"}], ".", 
               RowBox[{"ifisher", "[", "wf", "]"}]}]}]}]}]}]}], 
         "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"optimizeNatural", "[", 
     RowBox[{".001", ",", "W0f", ",", "20"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"ListPlot", "[", 
    RowBox[{"lossList", ",", 
     RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.699998008511332*^9, 3.69999802970809*^9}, {
  3.6999980699830923`*^9, 3.699998115492311*^9}, {3.6999981620238132`*^9, 
  3.69999822586194*^9}, {3.699998612549111*^9, 3.6999986129233723`*^9}, {
  3.699998815126917*^9, 3.699998835771031*^9}, {3.700001538705743*^9, 
  3.700001578257485*^9}, {3.700001657068907*^9, 3.7000016582819357`*^9}, {
  3.700002076531096*^9, 3.7000021281625767`*^9}, {3.700002164867529*^9, 
  3.700002182550308*^9}, {3.700002216470332*^9, 3.700002263745902*^9}}],

Cell[BoxData[
 GraphicsBox[{{}, {{}, 
    {RGBColor[0.368417, 0.506779, 0.709798], PointSize[0.012833333333333334`],
      AbsoluteThickness[1.6], PointBox[CompressedData["
1:eJxTTMoPSmViYGAQAWIQDQEf7LuME2vrTK/ZQwUcpp/7EWvheRnK53AovNSV
xLv8ApQv4GBw4JHPwpNnoHwRByEuKRu7UyegfAkHVb8be1bbHoXyZRw+qzjo
c4cfgvIVHCYnx0y6H3wAyldyYA3/8kzdeh+Ur+KQL7pt8Zd1e6B8NYcenrDP
y2fshvI1HD7IeqWcubsLytdyUIlgdf9TDOPrOMw1k920xgXG13PY6296bbUx
jG/gUHXx4NoUPRjf0GHTwrdBj3RgfCOHOav39FfA+cYOvW2bnWPgfBOHLuGq
EyFAPgBfU1cH
      "]]}, {}}, {}, {}, {{}, {}}},
  AspectRatio->NCache[GoldenRatio^(-1), 0.6180339887498948],
  Axes->{True, True},
  AxesLabel->{None, None},
  AxesOrigin->{0.703125, 0},
  DisplayFunction->Identity,
  Frame->{{False, False}, {False, False}},
  FrameLabel->{{None, None}, {None, None}},
  FrameTicks->{{Automatic, Automatic}, {Automatic, Automatic}},
  GridLines->{None, None},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImagePadding->All,
  Method->{"CoordinatesToolOptions" -> {"DisplayFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& ), "CopiedValueFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& )}},
  PlotRange->{{1., 20.}, {0, 0.347015020791155}},
  PlotRangeClipping->True,
  PlotRangePadding->{{
     Scaled[0.02], 
     Scaled[0.02]}, {
     Scaled[0.02], 
     Scaled[0.05]}},
  Ticks->{Automatic, Automatic}]], "Output",
 CellChangeTimes->{{3.69999821258387*^9, 3.699998226236745*^9}, 
   3.699998312173749*^9, 3.69999862551126*^9, 3.699998738339695*^9, {
   3.699998786572544*^9, 3.699998836871765*^9}, 3.6999988858001957`*^9, {
   3.700001541138788*^9, 3.7000015795585823`*^9}, 3.7000016595365477`*^9, 
   3.70000194699008*^9, 3.7000020160383*^9, {3.7000021011285954`*^9, 
   3.7000021296417*^9}, {3.700002169197653*^9, 3.700002184186553*^9}, 
   3.700002224968525*^9, 3.700002265070794*^9, 3.7000575931049013`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"plots", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"ArrayPlot", "[", 
      RowBox[{"#", ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"0", ",", "100"}], "}"}]}]}], "]"}], "&"}], "/@", 
    "preList"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"GraphicsGrid", "[", 
  RowBox[{"Partition", "[", 
   RowBox[{"plots", ",", "5"}], "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.6999988970449457`*^9, 3.6999989451291533`*^9}, {
  3.700001738578396*^9, 3.7000017454473352`*^9}}],

Cell[BoxData[
 GraphicsBox[{{}, {{InsetBox[
      GraphicsBox[RasterBox[CompressedData["
1:eJzN109IVEEcB/BnWYcyqDSNLCqoIOggJQhCDLEYKrFRkVFhZu5uRGiHTIKI
lGpLEQ/bnw0ScpMVSY1WKzJBIhS0pEOCbZ4UOhRUP1vwD5Fur978gr5zmIH1
4MLjc/j+Zt/Mj7fzZjefOnfQu9iyrGXySrav992Z91/PkUCtv58JjZZVHekM
eyZIoFznfnM2P+cLKXKeXjWcd7SGFE3vn5G6emjHNRKo6fgD/o1ve2MkUK7z
T2bNFreRIucjWc2F7+KkaHr/29PuvIZZEijX7a71XK34RYrm62u8cXz6z7r+
13T8SM3nwr4pe10g122Yc9/6as8X5VzX35nowMWkMCmazu9k9wXKvUMCNR2f
9mjX4fZWEijXBfonN42OkSLnS71bfpwOkSLnwZ3ZU9nNpMi5rr+6+T89nxNf
Zf/eUNPx+1t67m0dJYFyXcb3gDv4iRQ5r3OtSxnbS4qcd7RUeB8+IUXOM/d4
mi4XkKJpf3XrWyv3A9R0vL+8v3Hmg/27B03Hx0quvPINkUC5bt+RolBqFyly
7rt0M95k78eoaX91z2+i+0Oieefwi0CufT+U68qWHzu0LUqKnNefGTzhcZGi
aX91z69uf9CtL9H3my7PL1kTq257KVDT70+T/US5bkA+ryjnvm/OfoCa3r9I
vs9QrlshzwvofPWv425r8YPouEC57nq500+U83r5vKKm8/sZdvZblOtc8n2G
ch6S5wWU81J5HkP/zWPJs8pF7V2q89TfRPOI3G/RhTK/59uD6yNV4wLluscr
nX6iC2X+KZXOeQHluvSPznkM5XxQnndRzmPy/wTK+W8h5xJK
        "], {{0, 0}, {10, 
        10}}, {0, 1}],
       Frame->Automatic,
       FrameLabel->{None, None},
       FrameTicks->{{None, None}, {None, None}},
       GridLinesStyle->Directive[
         GrayLevel[0.5, 0.4]],
       Method->{
        "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
         Automatic}], {195., -194.4}, 
      ImageScaled[{0.5, 0.5}], {360., 360.00000000000006}], InsetBox[
      GraphicsBox[RasterBox[CompressedData["
1:eJzF109IVFEUBvAZHVyoBG2KyEUijDhuMmVKajjRIkgMwk21MgP/zGoWUlnZ
wkTMghZlqVmiBK6mmIQME6LBgpQBW6hlZDWRYC06FTUWYjT07mnxXepe8DE9
ePwW33n33Xfmcd+dwqORmvpsj8eTq05f+vRf6j7UlmJCPb+PT9RVtef83iXW
lPzfyvH3/EzgY6yzhwm1HT+1Zeb5VB8Tanu9NxA8HPnChErdi5azlR/GWFPy
y+37LpT8ZE3JV2NdJ5tWWNOt/pnyhmtTDaH074na3r/ox5sNxctMqNR9fUgL
tausKbmpv0OJG/krvaxpOz/vXMfm/nvpcUHb66Pl8Yv+B0yo1G3zTq+resea
kkeb28YP3GVNyXcN12zfOsKakpv6a5r/icrS6+HXTKjUDZPv1cgia9qOb8qP
f9+0e76RCZW697G+t8FR1pS856mv/2aYNSW/pfqJ2s5/Wa0HqO31p3fWdkYf
MaG21x+py/82+JIJlbr9BbHCgfusaTu+qb+m93et64Mp/3xlIu/YDBPq1vhl
44mD/nomVOqqVT9RyZvV+4pKblofTPNrVd8z1K3nLw8vZNVVPCbUrfEn1fuK
ujX+/86DpWPxZ+eShEpdKuL0E83U86dmne8Z6tb9OwKBwdBonNBMPV/yqrMe
oFK3Xq23qOSJkPM9Q23nv/GOsx9Dpa5a7XdRyVuK5p80Zic1/9ynTPUTzVB/
TfmpHc5+AZW622o/hko+pPa7qOQ56v8EKvkvGWKjng==
        "], {{0, 0}, {10, 10}}, {
        0, 1}],
       Frame->Automatic,
       FrameLabel->{None, None},
       FrameTicks->{{None, None}, {None, None}},
       GridLinesStyle->Directive[
         GrayLevel[0.5, 0.4]],
       Method->{
        "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
         Automatic}], {585., -194.4}, 
      ImageScaled[{0.5, 0.5}], {360., 360.00000000000006}], InsetBox[
      GraphicsBox[RasterBox[CompressedData["
1:eJzFl0FIlEEUxxc+L1qKKIUXRYk6qRGSdBsEhXC9uJCQF8FcQQ0rFTVkXVYM
dW8aIQtF0SWCFIxQXD2Iuh9CkYi4oAh5WIQiekuyJYjoh827/IecAT/0g+F3
+P/nzZvH8Ga+osZHPr/l8Xgy5EhzRpPdO7TwiwTSc/IlxWj5jBVcJ4Wsn07+
/q8vzedtlkZIIE3jd67lXS14TQJpOj8arE39cPaLZF9DfU/xx1lSyHrOXvP1
1QNSyHp3xZZ9M0UK3aqfTs+87318Y48E0nT993X99+JOvkj2LVSMdW06+0Wy
rqtv7OhpnTdMCk3z6x7+nvnHduoKNJ3vv/VgvzVGAsm+4HbwWTJBClmv3okP
rDvnAcl6U+pwKjRBClnX1VeXv7Xcnlb4lQSSfWtFi682PpNC0/g6vbLvXX2k
gwSSfQ1Zb7NWpkkh6yPW4d8vPaTQtL66/M7aH0q3rPziKAmk6fzB/JdRe5cE
kn1v7N+11+ZJoWl8XX115/ey7AdI0/U75lbDySMSSPY9aRkvvOLkgzSNr9NL
vLfTX7SRQJrWt0qeVyTruv6gy++s95tOD+cGYnez4wLpVvyAPK9It+JftP6t
LBQR4wmBZF+5rCfyvPbfK+8zpFvr+2o+DU/lbAjkee3voewHSPaVyX6LZH1b
3mdI0/x177Pn8r2LZN2X/WHy0p2EQtZ/ev/VE+lWfdtlv0Waxk+X7wUk+5bk
ewzJuu7965f/E0jWjwHm7car
        "], {{0, 0}, {10, 10}}, {0, 1}],
       Frame->Automatic,
       FrameLabel->{None, None},
       FrameTicks->{{None, None}, {None, None}},
       GridLinesStyle->Directive[
         GrayLevel[0.5, 0.4]],
       Method->{
        "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
         Automatic}], {975., -194.4}, 
      ImageScaled[{0.5, 0.5}], {360., 360.00000000000006}], InsetBox[
      GraphicsBox[RasterBox[CompressedData["
1:eJzFl01IVFEUx5/NgFYigu5qrEmiRYiMm6DNNSyK2oS0CYXCkhQHJXQY8ekE
bWrVbKQvdAq0RSGBZCGDCJpkLRQHP8nNQOgMkh5xECUSesQ9Lf4XuxfmUQ8e
v8XvvPtx3n33nueva6mu91iWdUjeXue2r0Suf0mTQFq/r03ReS/dFBgjhez/
Tr7290GPnZqIkkCatl8ZXSp81UsCafp857XwDeHMF8lx/eOlvtAgKWQ/9+Ls
1x+7pJB926rvac46KXQrfzr/6dSDvm6nP6Rp/4nTy/Q2QwLJcd35V48nnPki
2dsyn0j26dDH8lybFLK/ELNLLv0khew9tw727kyTQtP5HRvJtHRMkkBy3Fos
/OzIN1LIfmvhXGH1B1LIvurh4tBFZz0i2evyqxt/VX0yXjPqtAvkuJ4Nf15R
nBSatq/zzdHZzGgrCSTHBSK7tYl3pJB98aMe60yEFJrmVze+bPeHgYb2lfkh
EkjT54PxsqjP+d6QHLd+534m6LwPpGn7uvzq1m+2+4PO5909+rgyRgLpVvsV
9rZ34DYJpGl+detXtz/oxpft+abz/unDr0tGkgLJcVMHUo3eE8MKTftvlesV
6db4/7c/vzeR2F5NCSTHFch8Iv/Z/Pk8Q7rU/+LwzHjNy6RActz3wSdvAjfj
Ct3q/6TcD5Ac1y/3WyT7LnmeIdlflvUCkn1Y1mNI9rasd5F/8rPcVfz8fUoh
+88yn0i38petr5D1ApLj1mQ9hmS/IOtdJPsO+T+BZP8La+3oFA==
        "], {{0, 0}, {10,
         10}}, {0, 1}],
       Frame->Automatic,
       FrameLabel->{None, None},
       FrameTicks->{{None, None}, {None, None}},
       GridLinesStyle->Directive[
         GrayLevel[0.5, 0.4]],
       Method->{
        "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
         Automatic}], {1365., -194.4}, 
      ImageScaled[{0.5, 0.5}], {360., 360.00000000000006}], InsetBox[
      GraphicsBox[RasterBox[CompressedData["
1:eJzF101IVFEUB/BpcpNSC4laOC1Kw2hRNMjbFB6GSgiKsCCiXKSOQYQfDOEi
MAqjzKCiwFYVVLusWRhKCwnta1FGPMNFMfgxk9iAneljokVBjzhn87/UveAj
Bx4/hv957953eHPfnbVN7ftalkYikVI5SoLj4My5VDrLhEb+fAo0fbW6/Ema
DTX/t/r5e/74TNTzuphQ1+s3plde7L/OhLqev/Fh3Vghw4Rq3RD59T232VDz
ZEfz3QdFNtR8rvLQ/OgMG4bVP1v+Pc+JHzkm1HX81U87UuWfmVCtqz85P9z3
lQ01t/V369QWr+wYG2re7XdNeQU21Px1sWFT5zgbut5fbChR6z9jQrXu2om9
iWwwX1RzP7N79so9NtT8/Zeqqs6zbKi5rb+2+cfbMt/m7jOhWnfgZfHN6eA7
6np9W94S83tftDKhWlez7eaI38+GmnPPnp8Nwe8d1Xxc+om6zr9Z1gPU9fwP
Y92bbwXrHep6/vrs5I1fwfOKat2Ad3z7kkE2dL2+rb+253eh64MtXxONt965
wISGdf26VUfW8X4m1LW/SXleUc0rZD1AXec/LO8zNKz7XzbRODAymCNU6z75
O89Hd701dB0/Ls8rGtb8FzvPbOhtSsXyhGpdu/QT/V/3/1zeZ2hY46deVSfb
8jlCte7o5eWP+monDMMan2Q9QLXunay3qOY18j5DNb8k+wVU81nZj6GaZ2W/
i2r+8dRoWcmKvKHmvvQTDat/C80rZb+Aat0O2Y+hmtv2v4fl/wSq+W9OhfG5

        "], {{0, 0}, {10, 10}}, {0, 1}],
       Frame->Automatic,
       FrameLabel->{None, None},
       FrameTicks->{{None, None}, {None, None}},
       GridLinesStyle->Directive[
         GrayLevel[0.5, 0.4]],
       Method->{
        "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
         Automatic}], {1755., -194.4}, 
      ImageScaled[{0.5, 0.5}], {360., 360.00000000000006}]}, {InsetBox[
      GraphicsBox[RasterBox[CompressedData["
1:eJzF101IVFEUB/BHGkRCRk1RplFKMLaQ2rgo6yyGaBHmB2ZGpGZouRjEjz4o
q1nFkFT0AcogRQsjw4kgGSIHTEjIyoyxL8JSgprFGCc1XGSLws5pcQ51L/io
gcdv8T/v3vsOj/vurK2qK65OchxnIV3JP69DORfOL36PIHVmf19gS33FiL8d
lZz/Xf79OS9O/pT1rRxBajv+/enwjjUtCFLb+z9uzg4NPEOQct3QnarY1FlU
cn7x8t7KnglUcn7af7s78xUq3eqfKQ+kxl5sf4MgtZ0/dHRjY/QzgpTrdr/d
Nb8ggUrOTf091pufcmInKjn/unIGu+Ko5Hzk1HjfupeotH2+5sz4ng29CFKu
OzOZ5f0+jErOfc3R/s5WVP7OQ2XHK/ajknNTf03rfzRx40F/G4KU64bDsekP
11FpO74pX5WX42nchyDluvSMI+f6rqKS8wP3Sg5vqkcl59uon1Lb9UdpP5Da
3j/qPfi8vANBant/Q3iyp30KQcp165+kLRvsQqXt+Kb+Bul9lXI+1/3BlNeO
tazubkCQujX+69GbD6/kIki5Lpv6KeV8Ob2vUs5N+4NpfUX0PZO69fwL0iOL
CufFQcp1S7YW1fiS3ilt5w/S+yp1a/3/O494SpvGCxIg5ToP9VP6r55/kL5n
UrfmX5F3138rEAcp1z0ty2jyeceUbs1/jfYDKdc9pv1Wyvkl+p5JOU9N+3Ve
kHJ+ks5jUs6BzrtSzvMjgaVOZULJuZf6KXWrf3PNO+i8IOW6IJ3HpJybzr+1
9H9CyvkPeDXNhg==
        "], {{0, 0}, {10, 10}}, {0, 1}],
       Frame->Automatic,
       FrameLabel->{None, None},
       FrameTicks->{{None, None}, {None, None}},
       GridLinesStyle->Directive[
         GrayLevel[0.5, 0.4]],
       Method->{
        "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
         Automatic}], {195., -583.2}, 
      ImageScaled[{0.5, 0.5}], {360., 360.00000000000006}], InsetBox[
      GraphicsBox[RasterBox[CompressedData["
1:eJzFl01IVFEUgMeyFpEZLqyFmwklSDGKpCjxujDcOTgjIomNFAmaY80qsnRj
KIZDJiLqQookAhFTMRVB0CILkQGlRvFnBsNxapAjFDUgQoPe4+Ic8l54j3zw
+BbfeffncOfcM9Zb9+x3DlsslmPyjY2+rtritnwfCErLzrMpSjwnPH1PgBH9
/sTn3/6ruzUl8TwISt3xQ30rA+NuEJS63z9qd7y5NAqCEuOqz9rybpcB457/
5r2ZvQGM6P9MdF9LnQJGs/Kn8pn2Rde5jyAodecv9V20lodAUGJcfdjb4fQD
I3pVfl/lXC5OPgOM6D3DRVXX14AR/cumooXEWWDU3Z8163TGyFsQlBj37unD
UOQ9MKL/7l8YOv4AGNH/nJ9M86YDI3pVflXrj6kJTjqqQVBi3Oc62/TdVmDU
HV/lK4+U2e5fBUG5t/+B5qPp0XpBiT5hs/tLgx0Y0f+Q+aTUXb/R+hBwDyds
PQNBqft9ZsFSS++v6O+OEOMCV2KGUjqBUXd8VX5V59dofVD5kU/N66ccICjN
Gn87p6ciLhYEpW5+VedXVR9U6zN6v6n8zKAv7XlwXVBiHFyI/13uDDDqzp8t
zyulWes/aF8wZz/UOxoWlBj3WuaT8n/t3+j9pvKRhv7x3A8hQYlx210nbySt
rDKaNf+YrAeUGLcs6y0l+gl5n1Gib5H9AiX6iOzHKNE7Zb9Lib4wozH4AsKM
6OdkPinNyp9Rv/V4t1+gxDhVf6bqfyvl/wlK9H8B3l7Yug==
        "], {{0, 0}, {10, 
        10}}, {0, 1}],
       Frame->Automatic,
       FrameLabel->{None, None},
       FrameTicks->{{None, None}, {None, None}},
       GridLinesStyle->Directive[
         GrayLevel[0.5, 0.4]],
       Method->{
        "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
         Automatic}], {585., -583.2}, 
      ImageScaled[{0.5, 0.5}], {360., 360.00000000000006}], InsetBox[
      GraphicsBox[RasterBox[CompressedData["
1:eJzF112ITGEYB/Aj9sJqJ7YUzdgZjOJiaJYk4fExaiOF1tdi7ZKsLfYC+WiV
EqXcLGYyUdbFbrQ+GrW+FjdsuVK7SxZtI1u72+yYZ4UL5WvieW7+b5y39sTU
6Xfxf8553/P09p53Jm+vW7tzpOM4hXKNyl8zaituf+hkQp1fvyG6UHbu8I46
NtT87+rvz/mW1lvhaZwj1Pb5PufZoy8xJtT2/sb2YPe8RiZU68LXo9Hjc9lQ
88zmS6F4hg01/3ovM2VpGxt61T+3fFtBW31xigm1HT92tubqojQTqnUnJwbv
HMqvF1Rzt/6umVVccyqdM9S8L1Sy58BnNtS8a0Ls3f3HbGj7fjNnNz9MJplQ
rTu2ceyG1ptsqHlqcT81rGRDzafHh15l8usZ1Xy59BO1nX/v/KkHq8uZUK0L
JF7sip1mQ9vnu+W+ZeOvPf2WI1Trzkya01e9iQ0139tZVdrlZ0PNb0g/Udv5
F8l+gNre728vS6Z3M6G290cf9DS/ZyZU68r3r35ScIQNbZ/v1l+39Tvc/cEt
X1X/MrEvwoR69fzEJ39o4G6OUK1bL/1ENR8n6xXV3G1/cJvfVvmeoV69//OW
ow0dJ/oJ1bpEt68pMOKtoe34EVmvqFfz/9950feF8UjtIKFad1H6if6r938j
3zPUq/GDhWOaKrMDhGrdldSSQOpyr6FX4y+Q/QDVuqDst6jmUfmeoZr3yHkB
1fyHnMdQzc/LeRfVvKJkXYv/9aCh5h9H/+4n6lX/hptn5byAat0KOY+hmmfl
vItqHpb/E6jmPwE5p7VH
        "], {{0, 0}, {10, 10}}, {0, 1}],
       Frame->Automatic,
       FrameLabel->{None, None},
       FrameTicks->{{None, None}, {None, None}},
       GridLinesStyle->Directive[
         GrayLevel[0.5, 0.4]],
       Method->{
        "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
         Automatic}], {975., -583.2}, 
      ImageScaled[{0.5, 0.5}], {360., 360.00000000000006}], InsetBox[
      GraphicsBox[RasterBox[CompressedData["
1:eJzF101IVFEUB/CJJEqbgkKTWmT0YYlDaDBWMpyihQQWg0FQiz6ZaqGIQoS4
m6BV35QLKwxkBKlFQphEBAVC2BjU2Iem0JQNoznvRIErA4c4Zxb/S70L86gH
j9/if969dw6P++6sO9HcEFno8/kK5S7I3msPpxqXjDGhvt/Xd/pZFM58amVD
zf+uXn/O62vb3pY9dgi1Hf9FuO/XSz8Tavv8neCRL/VXmVCta7/y7ub+5Wyo
+YqikdHjDhtqXr2jsyH6lA296p9b3rH+0diTbibUdn5/Yur+hQQTmquLLRjY
EmdTyd3623UxM7y10zG0XV/PmevRwbtMqO3zb1LxeEmUCdW6SGvfQG12PFTz
jmB1aXE5G2p+oyI5UvHMMdR8mfQTtV3/psFLr5/vZEK17mQycHaoiw1tx3fL
P06lY4v6HUK17lh4qTOb7Qeq+eTpyo2pD45hrn/ST9R2/fnuD3Oxy6F0DRNq
+3ygpXFx3TgTqnXkX7Ov6QAb2o7v1l/X9zfP/cEtrwrOnKtczYR6Nf72ZPlw
abNDqNbtkn6imk/I+4pqnpD9ALVdf77fN7e8e+7Q0J5QilCt+zq56n3i2rih
7fyb5X1FvVr//85v9QdLHpyfJlTrHko/0X/1+3vle4Z6Nf/e3syrmZo0oVp3
anc8Epj9bOjV/BtkP0BzdT2y36KSt8j3DLVd3zY5j6Fa90POu6jmTXWj946G
vhlqflD6iXrVv3zzKjkvoFp3W85jqOYr5byLal4m/ydQzecBkYaxVA==
        "], {{0, 
        0}, {10, 10}}, {0, 1}],
       Frame->Automatic,
       FrameLabel->{None, None},
       FrameTicks->{{None, None}, {None, None}},
       GridLinesStyle->Directive[
         GrayLevel[0.5, 0.4]],
       Method->{
        "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
         Automatic}], {1365., -583.2}, 
      ImageScaled[{0.5, 0.5}], {360., 360.00000000000006}], InsetBox[
      GraphicsBox[RasterBox[CompressedData["
1:eJzF11FIU1EYB/BBGW0vtRU9LMqkfEhYL0kjRnxEi8oIyqKECCKxl5mRqwYr
ikDKh5oOE8qHIHJQgeBDBiH40CIJIQmC+RISWWIP5xsZlLGsqO97+R/qHuhS
g8vv4f+de879uJx7VnPsZGPLgkAgEJJr4Y/r3s6hN/sMExr4+StTtlKqvMiz
peZ/Vn+/zye2zY9Fegyhrvdfl9uUDb40hLqO76rvfTbayYRq3an22IEzH4yl
5l3DR5dv+MyWmo/vaW1KjrOlX/3zyq9Vh3ZtvcWEus7/sSm649EoE6p1wbdn
i8kxttQ8J/1ENV+WbOy9fMhYuq7v8GTtdP44E+o6vi5R9SqWYkK1rtJxYmDz
dbbUPNwZL58LsaXmA9nuwYsFY6m5V3+91p/hkefJeiZU656mBi81l9jS9f5e
+ZfJTE04ZQjVuv7V5f4ns8ZS86r7a2MNOWOpeUT6ibquv1b2A9R1vNm7ZShf
MYS6jqfdDbcTD5hQrWteVWyJ17Gl6/29+vtV3ldU86uyH6Cu83vl39rnbgTX
MKF+3f/I7JILd2KGUNf+fpL3FdV8vewHqOv6S/I9Q/16/vM3pzMrOqYI1bp0
T7S62DZh6Tr/dnlfUb/W/7/zxYW+RZH4DKFaV5B+ov/q+ffL9wz1a/6+kSsb
C3PvCNW6qaUrDz7ufm3p1/zh9K/9ANW6GdlvUc0fyvcMdV2f1/nstJx3Uc15
Pj2aSby31HxY+on61b+/zdvkvIBqXVTOY6jmXuffu/J/AtX8OyOMp0M=
        "], {{0, 
        0}, {10, 10}}, {0, 1}],
       Frame->Automatic,
       FrameLabel->{None, None},
       FrameTicks->{{None, None}, {None, None}},
       GridLinesStyle->Directive[
         GrayLevel[0.5, 0.4]],
       Method->{
        "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
         Automatic}], {1755., -583.2}, 
      ImageScaled[{0.5, 0.5}], {360., 360.00000000000006}]}, {InsetBox[
      GraphicsBox[RasterBox[CompressedData["
1:eJzF1k1IVFEUB/AHMwuLcEDKRR+LUktqUVJYEnECCTc5SokuxIWBEVL0AQMx
IwY5KJhCkG6yFBMxhYLCoXYRKdEoRuoiCsGJpgli7nUKIWphm3MQ/jd8F96j
Bobf4n/uxzs87ru7z10+0xJwHGcz/4OO/Fbo7zrO6N6G/tWXmtCNx62Pd8t7
h2JXu+oVobbzb20sTo7GFaG24/MmS+aPxjShUlfU/mP417QytJ3/SaKyfCqt
CfWrf275i9TM1ECfJtR2/XhP9Pit55pQqWta7rr74bU2lNytv1+e1d6J/swa
2u6vZvFzd9kWTajt+AVqen+vShMqddXbFm4fuqENJd8VGYm8XVKGkp/9vf9A
UUwZSt7B/URt938pPxlKHNaE2o73mqcDg4VxRxEqdd9T4ezHcWUoeSrv2FrF
HmUo+U7uJ2r7fIV8HqC240OZB0O1Y4pQ2/GPmutOBa9oQqXuROnJb71aGdrO
n+N+olJXw+8rKrnX88Etf9g6O3fhoCbUr/nnEm8iudksoVJH3E9U8hS/r6jk
7/g8QG337/X75pY3D2zfd+3+J0KlLnT9SGcmumhou/4kv6+oX/v/33kguWMs
OJIhVOpucj/Rf/X8Yf6eoX6t311cUHq+LU2o1LUu1Z3OhZYN/Vr/FZ8HqNRt
4vMW9Wv9p3wfQ6Vugu+7qOQN5SvhafXVUPLH3E/Ur/17zS/yfQGVOq/3M7f8
D0ZjbPY=
        "], {{0, 0}, {10, 10}}, {0, 1}],
       Frame->Automatic,
       FrameLabel->{None, None},
       FrameTicks->{{None, None}, {None, None}},
       GridLinesStyle->Directive[
         GrayLevel[0.5, 0.4]],
       Method->{
        "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
         Automatic}], {195., -972.}, ImageScaled[{0.5, 0.5}], {360., 360.}], 
     InsetBox[
      GraphicsBox[RasterBox[CompressedData["
1:eJzNlk0oBGEYx4ddKe36ukwiRUmkOPiOHqs4kPJxoeTgK05SilwQ4YCTokQp
FBKFKOSwB9ko5LC1lGQpNTNKaDmgvE/qeWXemvGxNf0Ov/8z7zPPvr0zMbUt
5Q0WSZKC2GWV8HcHX/Pn/WFV0lW7WwHK7+s+6wdX2y5tPgUoRevt2TNn0VUa
UGLu5XrUPdmschS9/1/79qVNr9KpAaVo/z0WbT1gSgNKzDlGnM6OLY0jehub
JyX68Ki06eEShaNof8knr7XNrSpQitbbN3yx6db3/50Qc9bbvvvMCo0j+oO9
/OXkXpUj+gJ3w8N8pMoRvd589frv9osoklM0oBStN+rtliFPeb4ClJgb8RZ3
bcerHNE7ssZGT+sVjuhdbJ6Uos/Xz84DStH6ncCmnDpZBUrR+oUJT3bpkwqU
mMvoaSwbH1A5it5/mM2TEnN+bL9Sojd6Puj5OP9q506eBpRm3d+Z8CxvhitA
iblMNk9K9MFsv1Ki1zsf9Poz+n7T8zUHhS7f/gVQYq7Eu5J7l3rMUXT9WbZf
Kc3q/699+tbcUcCjFygx18vmSflbz2/0/abnH0KP12zSFVBirtLhcSUunnM0
a32ZnQeUmNtl5y2lWesb9aeB/pMTHTdAibmQsI95Uv6X/ofY9wIl5mT2PUZp
Vv9v2ZAsQA==
        "], {{0, 0}, {10, 10}}, {0, 1}],
       Frame->Automatic,
       FrameLabel->{None, None},
       FrameTicks->{{None, None}, {None, None}},
       GridLinesStyle->Directive[
         GrayLevel[0.5, 0.4]],
       Method->{
        "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
         Automatic}], {585., -972.}, ImageScaled[{0.5, 0.5}], {360., 360.}], 
     InsetBox[
      GraphicsBox[RasterBox[CompressedData["
1:eJxTTMoPSmVmYGDggmIWBhj4YI+dpr18pvDKm3IX39ij0/j1IfQnG6btPfvy
jT06Taz+gzxdshN43tuj0zB1Fgz6kzNXvMWgiTV/oOWNVG9x/LR/b49OE+v+
lgc5PTMy39uj0zB1iQxqKzXnvsegYfKEwncHx8TCs0xvMGhi3efBfTbysd9b
e3SaWP3T95z6tKTunT06DVN36++WaUw/32HQMPnLu7du2XriLQYND5+7+csn
eL/FoGHyzdDwRKeJdb+yH4/IQaX39ug0sfoplZ/75Ftj04XX9ug0TJ1HvX59
kc5bDBomH11/xejsr9cYNEz+PDQ80Wli/ZcCLQ/QaWL1t1UuYgvjfWuPThOr
P6wyPp1D5J09Og1Tt7ZM9rnnvrcYNLHmO0LDE52GqSOUfo2h5QE6Taz9hOTP
vVv96UPwe3t0mlrmn387dfviWa/t0WmYui3Q8ESnYfIzoOkVnYbJT4KWB+g0
se7PgdZn6DS1/M9QsOVansk9ewwaqi7mT5rb4e1nMGhi7Y+Cpld0mmruH2B5
y7lBUw74PrFHp2HqaqHhiU7Ty/+U1m+E5G2zX3HVtDyyR6dh6nxVQov4Ft/G
oKll/x1oeYBOw9T1QMtbdJpa9lMqv/ZLJVfbjaf26DRM3URoeKLTg8X9htD2
AjoNU0dp+4yQPADr80F/
        "], {{0, 0}, {10, 10}}, {0, 1}],
       Frame->Automatic,
       FrameLabel->{None, None},
       FrameTicks->{{None, None}, {None, None}},
       GridLinesStyle->Directive[
         GrayLevel[0.5, 0.4]],
       Method->{
        "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
         Automatic}], {975., -972.}, ImageScaled[{0.5, 0.5}], {360., 360.}], 
     InsetBox[
      GraphicsBox[RasterBox[CompressedData["
1:eJxTTMoPSmVmYGDggmIWBhj4YI+dpr38i5YJHsw7X9mj0/j1IfSvKg2N1j7/
yh6dJlZ/1cEWVqucd/boNEzdMaOOpEi5Nxg0seYPtPypqfe0+w6/s0eniXW/
bHTQr4//39mj0zB1s8+6PX4T/R6DhslXQ8MTnYbJW5udvSBX8RKDJtZ9Mfv/
skRKvLZHp4nVf/e24OzDJW/t0WmYOnndf2sCnd9h0DB5vvR0I0//Nxg0TH6d
48rFj2e/xqBh8srQ8ESniXX/Qf4VbZ6M7+3RaWL1Uyofz9DEv/fzC3t0GqZO
cIJxNb/1awwaJh8Tl75lsfFLDJrY8CXkvpXQ8gCdJlY/3+m4jt28r+3RaWL1
G/Y6HH8T9cYenYapC/S9e+q7/hsMmljzhaDhiU7D1IlA0ys6DZM/Ai0P0Gli
7SckzzHjbIpE7nt7dJpa5reW3Lm1YNkLe3Qaps4fGp7oNEw+A5pe0WmY/BVo
eYBOE+v+t9D6DJ2mlv9fVNZFpFveskenYeq6tk3Pk/90BIMm1v4fPZD0ik5T
y/0DLc91ZimHbfIje3Qapi62GhKe6DS9/G8Lrc/QaWrZv2x7htHC1gf26DRM
3eEPs4JUjt3AoKllvx60PECnYepEoOUtOk0t+ymVXx7k4H977mN7dBqm7gU0
PNHpweL+xdD2AjoNUxcIbY+h09RyPwBDfio8
        "], {{0, 0}, {10, 10}}, {0, 1}],
       Frame->Automatic,
       FrameLabel->{None, None},
       FrameTicks->{{None, None}, {None, None}},
       GridLinesStyle->Directive[
         GrayLevel[0.5, 0.4]],
       Method->{
        "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
         Automatic}], {1365., -972.}, ImageScaled[{0.5, 0.5}], {360., 360.}], 
     InsetBox[
      GraphicsBox[RasterBox[CompressedData["
1:eJxTTMoPSmVmYGDggmIWBhj4YI+dpr389aJ1umv7n9mj0/j1IfQLlZsH6a18
Zo9OE6tfYwfjYwatt/boNExd4ospP6P4XmLQxJo/0PIqAWeCnpx4a49OE+t+
z4WZ9xn03tmj0zB1zOEZEg3X32HQMHkdaHii0zD5u/dli2/XPMGgiXVf1von
HqcPP7NHp4nVv6zItvVCxmt7dBqmjlGb4cmx228waJh8juaCyROSXmLQMPnz
Zv4rp1i/wKBh8hHQ8ESniXW/x5pQDckd7+zRaWL1Uyp/5N738wqBj+3RaZg6
oaTAjQnpzzFomPyrCVcKnA48xqBh8sbQ8ESnifWfDLQ8QKeJ1a91MdLBWOe5
PTpNrP5O44/nZf6/sEenYeqWHntwQVrhJQZNrPnHEiHhiU7D1DFD0ys6DZPn
g5YH6DSx9hOSP2p31lRxynt7dJpa5uusTwxmOf/IHp2GqfsBDU90GiY/B5pe
0WmYfB60PECniXX/Q2h9hk5Ty//82z6+4ey+bI9Ow9Rd//lom4D2cgyaWPuj
oOkVnaaW+wdavkPV1j5qzz17dBqm7h00PNFpevlfH1qfodPUsj+NteTz6Rs3
7dFpmLpwPd8ovg+XMGhq2X8KWh6g0zB1Sy5Aylt0mlr2UyqfeGD+20el9+3R
aZi6wyyQ8ESnB4v7V0LbC+g0TJ3FA0h7DJ2mlvsBo/k25A==
        "], {{0, 0}, {10, 
        10}}, {0, 1}],
       Frame->Automatic,
       FrameLabel->{None, None},
       FrameTicks->{{None, None}, {None, None}},
       GridLinesStyle->Directive[
         GrayLevel[0.5, 0.4]],
       Method->{
        "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
         Automatic}], {1755., -972.}, 
      ImageScaled[{0.5, 0.5}], {360., 360.}]}, {InsetBox[
      GraphicsBox[RasterBox[CompressedData["
1:eJxTTMoPSmVmYGDggmIWBhj4YI+dpr38Q4Oz3z8dvWOPTuPXh9D/krtl/xX+
u/boNLH6o5JjwzvXvbJHp2HqPHm+ve3lfIxBE2v+QMv71L700Lr12h6dJtb9
L1qK1vpPfGOPTsPUHWlO0s27+BaDhskHQ8MTnYbJW8zMq1Ktv4pBE+u+60lR
X2xm37FHp4nVfzjLOzU37bk9Og1T91+An6lc6hUGDZN/GGepVLDkMQYNk88+
mFTiOvUhBg2TnwsNT3SaWPdPLik4w6/0zh6dJlY/pfLVfVGOkf0X7NFpmLqL
p4/tP3b+PgYNk1cz9nXo1LmEQcPkheMh4YlOE+u/pdDyAJ0mVn9w/TrNDvP7
9ug0sfrXK95e/LvwkT06DVN3+fTHJXyKjzFoYs13PAMJT3Qapm4FNL2i0zD5
vdDyAJ0m1n5C8jWrFJucb7y3R6epZX7/rPN/lqSetUenYer6oeGJTsPk+fsh
6RWdhsmfgJYH6DSx7r9kCKnP0Glq+Z8hZ0Kw16xd9hg0lczfD02v6DTV3E+h
/LYZ9xsbXF7bo9MwdWXRdrJT+99g0DD58PWON4zLL2PQMPmYBEh4otP08n9P
PKQ+Q6epZX/rka1r33cet0enYeq4ZjM1xrbvxqBh8htjIOGJThPrPr7VkPIA
nYapO9MAKW/RaWr5n1L5O2sEfnhPvmCPTsPUtR6FhisaDZPXnANJr+g0vfw3
qxjSXkCnYeoyZ0DaY+g0tdwHAAZnUIs=
        "], {{0, 0}, {10, 10}}, {0, 1}],
       Frame->Automatic,
       FrameLabel->{None, None},
       FrameTicks->{{None, None}, {None, None}},
       GridLinesStyle->Directive[
         GrayLevel[0.5, 0.4]],
       Method->{
        "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
         Automatic}], {195., -1360.8000000000002}, 
      ImageScaled[{0.5, 0.5}], {360., 359.9999999999998}], InsetBox[
      GraphicsBox[RasterBox[CompressedData["
1:eJxTTMoPSmVmYGDggmIWBhj4YI+dHv7yn2Tq5/VdeGqPTsPUrUu5nZfz7wwG
jd/cweM/h3U7PV/zv7BHp4l1/1rpefp3M17ao9MwdTvCvY6xn3+NQcPkPWQh
4YlOE2s/reWFrv1n4Za5b49Ow9TNOTj9y/6tTzBomPzK2cGcEacvYNAw+WeF
IUUGxocwaJj8YRlIeKLTxIZPY9TpgN7vb+zR6cESvgwib2vObl9sj0ET6b60
uZDwRKfp5T/j8Dd3+ztm2aPTxNp/Z/uMV7pTjtmj0zB1s941r9KcdhaDJtb8
JTqQ8ESnYeoSDkDSKzoNk7+0BlIeoNP0Cl9ay9u+gIQnOk2s//ZAywN0mlj9
hOTXnzjYVir/xB6dhqkLLJONT616gkFTy35C8ppLIOkVnaaX/YTkfVMmqjnE
3bVHp2HqtmQesytedBuDHizuH+ryQWmQ8ESnYepmlELSKzqN31yk8t8NUt6i
08TqH+zyHjmQ9IpOw9QtOQQpD9Bpavl/WjikvYBOU8t8QvIA0aWy5w==
        "], {{0, 
        0}, {10, 10}}, {0, 1}],
       Frame->Automatic,
       FrameLabel->{None, None},
       FrameTicks->{{None, None}, {None, None}},
       GridLinesStyle->Directive[
         GrayLevel[0.5, 0.4]],
       Method->{
        "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
         Automatic}], {585., -1360.8000000000002}, 
      ImageScaled[{0.5, 0.5}], {360., 359.9999999999998}], InsetBox[
      GraphicsBox[RasterBox[CompressedData["
1:eJxTTMoPSmVmYGDggmIWBhj4YI+dHv7yvA8avT9MvGGPTuPXN3jcT0j+TP/y
jWJLHtij08T6r/XIAdcwq8f26DRM3aZS77nd959j0DD5b3ch4YlOE2s/reVt
uc5mHnldaY9Ow9TV+nZUyPtfwaCp5X6Tg5DwRKeJNX9NT4FL+JpX9ug0sfq7
1tx1W73kvT06TS3/jcoPrHxXJyS9otMwdd8mQMoDdBq/uYPHf7SWN3Y+DS4P
0Gn8+gaP+0flB7c8ywFIeYtO49c3eNw/Kj+05Q+shbQX0Gn8+qhnPwDo7AAQ

        "], {{0, 0}, {10, 10}}, {0, 1}],
       Frame->Automatic,
       FrameLabel->{None, None},
       FrameTicks->{{None, None}, {None, None}},
       GridLinesStyle->Directive[
         GrayLevel[0.5, 0.4]],
       Method->{
        "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
         Automatic}], {975., -1360.8000000000002}, 
      ImageScaled[{0.5, 0.5}], {360., 359.9999999999998}], InsetBox[
      GraphicsBox[RasterBox[CompressedData["
1:eJxTTMoPSmVmYGDggmIWBhj4YI+dHpUf6vLy07LKg19vsEen8etD6N/LWBL4
r/mMPToNU7cy2uNZivYDDJpY80e6/BJPSHii0/j1IfSbef6bk6H7zB6dJla/
yraMVLV57+zRaWL1j8oPbXn5i5mQcgGNxq9v8Lh/VH5UfijLW02BlLfoNH59
g8f9o/JDW/5lKaS9gE7j10c9+wE3dbpc
        "], {{0, 0}, {10, 10}}, {0, 1}],
       Frame->Automatic,
       FrameLabel->{None, None},
       FrameTicks->{{None, None}, {None, None}},
       GridLinesStyle->Directive[
         GrayLevel[0.5, 0.4]],
       Method->{
        "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
         Automatic}], {1365., -1360.8000000000002}, 
      ImageScaled[{0.5, 0.5}], {360., 359.9999999999998}], InsetBox[
      GraphicsBox[RasterBox[CompressedData["
1:eJxTTMoPSmVmYGDggmIWBhj4YI+dHpUflccvb/uoceLbsoX26DR+fYPH/UNd
/hczB9fH/bfs0Wn8+hD6+9Z9ums55409Ok2s/lH5UflR+VH5UXny5FufQMpb
dBq/vsHj/lH5oS2/uJkT3F5Ap/Hro579ANlRnMU=
        "], {{0, 0}, {10, 10}}, {0, 
        1}],
       Frame->Automatic,
       FrameLabel->{None, None},
       FrameTicks->{{None, None}, {None, None}},
       GridLinesStyle->Directive[
         GrayLevel[0.5, 0.4]],
       Method->{
        "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
         Automatic}], {1755., -1360.8000000000002}, 
      ImageScaled[{0.5, 0.5}], {360., 359.9999999999998}]}}, {}},
  ContentSelectable->True,
  ImageSize->{579.3359375, Automatic},
  PlotRangePadding->{6, 5}]], "Output",
 CellChangeTimes->{{3.699998900867217*^9, 3.699998945526307*^9}, {
   3.700001555335806*^9, 3.700001580676322*^9}, 3.700001660653626*^9, 
   3.700001745909501*^9, 3.700001949991146*^9, 3.700057595746003*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Plot weight magnitudes in two layers", "Subsection",
 CellChangeTimes->{{3.700002818338657*^9, 3.70000282573601*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"layer1sizes", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"magnitudeVec", "[", 
      RowBox[{"1", ",", "#"}], "]"}], "&"}], "/@", "pointList"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"layer2sizes", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"magnitudeVec", "[", 
      RowBox[{"2", ",", "#"}], "]"}], "&"}], "/@", "pointList"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"ListPlot", "[", 
  RowBox[{"{", 
   RowBox[{"layer1sizes", ",", "layer2sizes"}], "}"}], "]"}]}], "Input",
 CellChangeTimes->{3.700002815749415*^9}],

Cell[BoxData[
 GraphicsBox[{{}, {{}, 
    {RGBColor[0.368417, 0.506779, 0.709798], PointSize[0.012833333333333334`],
      AbsoluteThickness[1.6], PointBox[CompressedData["
1:eJxTTMoPSmViYGAQAWIQDQEf7Ls+rL4y6+ZTe6iAQ9f6tG7pxJdQPoeDCFOz
M8eVd1C+gEOf7iYlG/aPUL6Iw5t1Gr98n8D4Eg6n7/LXcqd9gvJlHNLLP7G5
7YbxFRyUxFc5lz6B8ZUcLPPNGM0vw/gqDp4feX2N6mF8NQeH71mW/Ldg5ms4
sKsZr3n14AOUr+UQOVlkvV7Jeyhfx0G5LnnRu8i3UL6eA0/Cze6NV19D+QYO
jAmbPG88fwXlGzqkdu13PJIE4xs5NC8Nq1wgDeMbO9y6sWZX4TdYeJg4fEor
4LZ6/NIeAACfWu8=
      "]]}, 
    {RGBColor[0.880722, 0.611041, 0.142051], PointSize[0.012833333333333334`],
      AbsoluteThickness[1.6], PointBox[CompressedData["
1:eJxTTMoPSmViYGAQAWIQDQEf7C+cDZF+Z/PeHirgsKou0/GeGYzP4cB564Bp
fRKML+Agyph0UXofjC/iMNnCZdMkmQ9QvoTDxw1THLPjYHwZh69a+QnHJ8D4
Cg4perYXS6bC+EoOb7XTqhhTYHwVh7KjXlvWws1Tc6hbJzCpeyvMPg2HGbN9
uUUDYXwtB0Z3ga+/FWB8HYdNQmycT2xhfD2HA2GZDrf8YHwDh7MCtyPFI2B8
Q4fC1wZZX2JgfCOHb04nn1fGw/jGDqJMaxSPJcD4Jg6ZPpubChLf2wMAweFY
YA==
      "]]}, {}}, {}, {}, {{}, {}}},
  AspectRatio->NCache[GoldenRatio^(-1), 0.6180339887498948],
  Axes->{True, True},
  AxesLabel->{None, None},
  AxesOrigin->{0., 0.6579149464867627},
  DisplayFunction->Identity,
  Frame->{{False, False}, {False, False}},
  FrameLabel->{{None, None}, {None, None}},
  FrameTicks->{{Automatic, Automatic}, {Automatic, Automatic}},
  GridLines->{None, None},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImagePadding->All,
  Method->{"CoordinatesToolOptions" -> {"DisplayFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& ), "CopiedValueFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& )}},
  PlotRange->{{0., 20.}, {0.6828130868666602, 1.18077589446461}},
  PlotRangeClipping->True,
  PlotRangePadding->{{
     Scaled[0.02], 
     Scaled[0.02]}, {
     Scaled[0.05], 
     Scaled[0.05]}},
  Ticks->{Automatic, Automatic}]], "Output",
 CellChangeTimes->{3.700002816048431*^9, 3.7000575985259*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Plot update per layer", "Subsection",
 CellChangeTimes->{{3.700003082783553*^9, 3.700003089420795*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"updates1", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"vectorBlock", "[", 
       RowBox[{"1", ",", 
        RowBox[{"temp", "[", 
         RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ".", 
      RowBox[{"matrixBlock", "[", 
       RowBox[{"1", ",", " ", "1", ",", " ", 
        RowBox[{"preList", "[", 
         RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ".", 
      RowBox[{"vectorBlock", "[", 
       RowBox[{"1", ",", 
        RowBox[{"temp", "[", 
         RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "20"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"updates2", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"vectorBlock", "[", 
       RowBox[{"2", ",", 
        RowBox[{"temp", "[", 
         RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ".", 
      RowBox[{"matrixBlock", "[", 
       RowBox[{"2", ",", " ", "2", ",", " ", 
        RowBox[{"preList", "[", 
         RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ".", 
      RowBox[{"vectorBlock", "[", 
       RowBox[{"2", ",", 
        RowBox[{"temp", "[", 
         RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "20"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"updates3", "=", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"vectorBlock", "[", 
        RowBox[{"3", ",", 
         RowBox[{"temp", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ".", 
       RowBox[{"matrixBlock", "[", 
        RowBox[{"3", ",", " ", "3", ",", " ", 
         RowBox[{"preList", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ".", 
       RowBox[{"vectorBlock", "[", 
        RowBox[{"3", ",", 
         RowBox[{"temp", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "20"}], "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"ListPlot", "[", 
  RowBox[{"{", "updates1", "}"}], "]"}]}], "Input",
 CellChangeTimes->{{3.70000318464629*^9, 3.70000325097761*^9}}],

Cell[BoxData[
 GraphicsBox[{{}, {{}, 
    {RGBColor[0.368417, 0.506779, 0.709798], PointSize[0.012833333333333334`],
      AbsoluteThickness[1.6], PointBox[CompressedData["
1:eJxTTMoPSmViYGAQAWIQDQEf7L3U4pZlv75vDxVwOPbQd+kXvltQPofD5edm
y1W/XYPyBRwKpnx/tG3iFShfxCFiZtjBLpVLUL6EA5//KZu1y89B+TIOZfEL
vhtbnIDyFRxaJ/oGvjM6BOUrOQR8trVvct8D5as4BO7TkJtzdRuUr+bgrRDz
p//mRihfw+GU19NWqQ0roXwth5wZmn2lyxZA+ToO6u3ZQQeXToby9RyWF7ux
2hxqhfINHI4YdTHoWJVD+YYOgfe89KK8M6B8Iwftd+EMzYqRUL6xw79/Pi9F
bnhC+SYOn+6/W8VQb2UPADadV2Q=
      "]]}, {}}, {}, {}, {{}, {}}},
  AspectRatio->NCache[GoldenRatio^(-1), 0.6180339887498948],
  Axes->{True, True},
  AxesLabel->{None, None},
  AxesOrigin->{0., 0},
  DisplayFunction->Identity,
  Frame->{{False, False}, {False, False}},
  FrameLabel->{{None, None}, {None, None}},
  FrameTicks->{{Automatic, Automatic}, {Automatic, Automatic}},
  GridLines->{None, None},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImagePadding->All,
  Method->{"CoordinatesToolOptions" -> {"DisplayFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& ), "CopiedValueFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& )}},
  PlotRange->{{0., 20.}, {0, 0.4987439274487754}},
  PlotRangeClipping->True,
  PlotRangePadding->{{
     Scaled[0.02], 
     Scaled[0.02]}, {
     Scaled[0.02], 
     Scaled[0.05]}},
  Ticks->{Automatic, Automatic}]], "Output",
 CellChangeTimes->{{3.7000032461069803`*^9, 3.700003251552055*^9}, 
   3.700057600740404*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ListPlot", "[", 
  RowBox[{"{", "updates2", "}"}], "]"}]], "Input",
 CellChangeTimes->{{3.700003258444854*^9, 3.700003258519554*^9}}],

Cell[BoxData[
 GraphicsBox[{{}, {{}, 
    {RGBColor[0.368417, 0.506779, 0.709798], PointSize[0.012833333333333334`],
      AbsoluteThickness[1.6], PointBox[CompressedData["
1:eJxTTMoPSmViYGAQAWIQDQEf7EvV4pZlv75vDxVwOPPQd+kXvltQPofDhedm
y1W/XYPyBRyapnx/tG3iFShfxCF0ZtjBLpVLUL6EA4f/KZu1y89B+TIOmfEL
vhtbnIDyFRzKJvoGvjM6BOUrOXh/trVvct8D5as4OO3TkJtzdRuUr+YQoBDz
p//mRihfw+GI19NWqQ0roXwth7QZmn2lyxZA+ToOFu3ZQQeXToby9RzWFrux
2hxqhfINHL4ZdjHoWJVD+YYOFXe99KK8M6B8I4dF78MZmhUjoXxjh4b/Pi9F
bnhC+SYOYXffrWKot7IHAHLnVy8=
      "]]}, {}}, {}, {}, {{}, {}}},
  AspectRatio->NCache[GoldenRatio^(-1), 0.6180339887498948],
  Axes->{True, True},
  AxesLabel->{None, None},
  AxesOrigin->{0., 0},
  DisplayFunction->Identity,
  Frame->{{False, False}, {False, False}},
  FrameLabel->{{None, None}, {None, None}},
  FrameTicks->{{Automatic, Automatic}, {Automatic, Automatic}},
  GridLines->{None, None},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImagePadding->All,
  Method->{"CoordinatesToolOptions" -> {"DisplayFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& ), "CopiedValueFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& )}},
  PlotRange->{{0., 20.}, {0, 0.49874392744877777`}},
  PlotRangeClipping->True,
  PlotRangePadding->{{
     Scaled[0.02], 
     Scaled[0.02]}, {
     Scaled[0.02], 
     Scaled[0.05]}},
  Ticks->{Automatic, Automatic}]], "Output",
 CellChangeTimes->{3.700003258765863*^9, 3.700057603473814*^9}]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Regular gradient descent", "Section",
 CellChangeTimes->{{3.699998651496395*^9, 3.699998655049646*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"optimizeRegular", "[", 
    RowBox[{"lr_", ",", "w0f_", ",", "iters_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "wf", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pointList", ",", " ", "gradList", ",", "preList", ",", " ", 
         "lossList"}], "}"}], "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", "}"}], ",", 
         RowBox[{"{", "}"}], ",", 
         RowBox[{"{", "}"}], ",", 
         RowBox[{"{", "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wf", "=", "w0f"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"iter", "=", "1"}], ",", 
        RowBox[{"iter", "\[LessEqual]", "iters"}], ",", 
        RowBox[{"iter", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"pointList", "=", 
          RowBox[{"pointList", "~", "Append", "~", "wf"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"gradList", "=", 
          RowBox[{"gradList", "~", "Append", "~", 
           RowBox[{"gradf", "[", "wf", "]"}]}]}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"preList", "=", 
          RowBox[{"preList", "~", "Append", "~", 
           RowBox[{"ihessf", "[", "wf", "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"lossList", "=", 
          RowBox[{"lossList", "~", "Append", "~", 
           RowBox[{"lossf", "[", "wf", "]"}]}]}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"wf", "=", 
          RowBox[{"wf", "-", 
           RowBox[{"lr", "*", 
            RowBox[{"gradf", "[", "wf", "]"}]}]}]}]}]}], 
       "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"optimizeRegular", "[", 
   RowBox[{".5", ",", "W0f", ",", "20"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
   "\"\<~/git/whitening/exp/data/natural_gradient_multilayer_losses_regular.\
csv\>\"", ",", "lossList"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"ListPlot", "[", 
  RowBox[{"lossList", ",", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.6999986641339006`*^9, 3.6999986860195017`*^9}, {
  3.699998847150424*^9, 3.699998850071939*^9}, {3.700056214134197*^9, 
  3.700056220468603*^9}, {3.7000752500723057`*^9, 3.700075271492931*^9}}],

Cell[BoxData[
 GraphicsBox[{{}, {{}, 
    {RGBColor[0.368417, 0.506779, 0.709798], PointSize[0.012833333333333334`],
      AbsoluteThickness[1.6], PointBox[CompressedData["
1:eJxTTMoPSmViYGAQAWIQDQEf7LuME2vrTK/ZQwUcnjw+tdbl5RMon8PB4fP5
O8/UP0P5Ag5XXgSnalx6C+WLODSWlwh26L+E8iUclv8UaLHYex/Kl3F4uti2
osj8AJSv4GBzsqlYq2c/lK/k8Gt//4+UNwehfBWH6F0tBTETYerVHCqE9was
qjoM5Ws4aDneF4pkganXcjjhc3tvVPQRKF/HQelu09dbGjB5PYdX36+nP54L
kzdwMDV192TTgskbOhS18f2MnQmTN3KYnJLxaIoCTN7YwUJO8JFYA0zexKFz
iy/nTZGD9gB0UlsU
      "]]}, {}}, {}, {}, {{}, {}}},
  AspectRatio->NCache[GoldenRatio^(-1), 0.6180339887498948],
  Axes->{True, True},
  AxesLabel->{None, None},
  AxesOrigin->{0.703125, 0},
  DisplayFunction->Identity,
  Frame->{{False, False}, {False, False}},
  FrameLabel->{{None, None}, {None, None}},
  FrameTicks->{{Automatic, Automatic}, {Automatic, Automatic}},
  GridLines->{None, None},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImagePadding->All,
  Method->{"CoordinatesToolOptions" -> {"DisplayFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& ), "CopiedValueFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& )}},
  PlotRange->{{1., 20.}, {0, 1.1972416520577127`}},
  PlotRangeClipping->True,
  PlotRangePadding->{{
     Scaled[0.02], 
     Scaled[0.02]}, {
     Scaled[0.02], 
     Scaled[0.05]}},
  Ticks->{Automatic, Automatic}]], "Output",
 CellChangeTimes->{{3.699998679394189*^9, 3.699998686371147*^9}, 
   3.6999987466920147`*^9, 3.699998802888177*^9, 3.699998851028626*^9, {
   3.7000562115392113`*^9, 3.700056222379306*^9}, 3.700057605835108*^9, 
   3.700075239656262*^9, 3.700075272542485*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Generate data for TF", "Section",
 CellChangeTimes->{{3.700068342450616*^9, 3.700068347092957*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
   "\"\<~/git/whitening/exp/data/natural_gradient_multilayer_W0f.csv\>\"", 
    ",", "W0f"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
   "\"\<~/git/whitening/exp/data/natural_gradient_multilayer_XY0.csv\>\"", 
    ",", 
    RowBox[{"X0", "~", "Join", "~", "Y0"}]}], "]"}], ";", 
  RowBox[{"Export", "[", 
   RowBox[{
   "\"\<~/git/whitening/exp/data/natural_gradient_multilayer_fs.csv\>\"", ",",
     "fs"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
   "\"\<~/git/whitening/exp/data/natural_gradient_multilayer_loss0.csv\>\"", 
    ",", 
    RowBox[{"lossf", "[", "W0f", "]"}]}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.700068357966646*^9, 3.700068358369865*^9}, {
  3.7000684489870443`*^9, 3.700068496597328*^9}, {3.700068528097978*^9, 
  3.700068543790595*^9}, {3.700068752969454*^9, 3.700068760139933*^9}, {
  3.700069002005844*^9, 3.700069007213793*^9}, {3.700075003303822*^9, 
  3.700075010379438*^9}}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{808, 1978},
WindowMargins->{{Automatic, 809}, {Automatic, 0}},
FrontEndVersion->"11.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (September \
21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 126, 1, 92, "Title"],
Cell[709, 25, 89, 1, 64, "Section"],
Cell[CellGroupData[{
Cell[823, 30, 89, 1, 50, "Section"],
Cell[915, 33, 19486, 528, 2026, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[20438, 566, 98, 1, 64, "Section"],
Cell[20539, 569, 2754, 68, 306, "Input"],
Cell[CellGroupData[{
Cell[23318, 641, 410, 7, 54, "Input"],
Cell[23731, 650, 1854, 42, 244, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[25634, 698, 108, 1, 64, "Section"],
Cell[CellGroupData[{
Cell[25767, 703, 7039, 191, 724, "Input"],
Cell[32809, 896, 2159, 46, 237, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[35005, 947, 549, 15, 54, "Input"],
Cell[35557, 964, 22988, 466, 476, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[58582, 1435, 123, 1, 44, "Subsection"],
Cell[CellGroupData[{
Cell[58730, 1440, 578, 18, 75, "Input"],
Cell[59311, 1460, 2215, 49, 250, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[61575, 1515, 109, 1, 44, "Subsection"],
Cell[CellGroupData[{
Cell[61709, 1520, 2214, 64, 201, "Input"],
Cell[63926, 1586, 1767, 41, 244, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[65730, 1632, 157, 3, 32, "Input"],
Cell[65890, 1637, 1739, 40, 244, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[67690, 1684, 109, 1, 64, "Section"],
Cell[CellGroupData[{
Cell[67824, 1689, 2465, 60, 327, "Input"],
Cell[70292, 1751, 1928, 43, 240, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[72269, 1800, 105, 1, 64, "Section"],
Cell[72377, 1803, 1068, 26, 96, "Input"]
}, Open  ]]
}, Open  ]]
}
]
*)

