(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    102268,       2701]
NotebookOptionsPosition[     99452,       2598]
NotebookOutlinePosition[     99812,       2614]
CellTagsIndexPosition[     99769,       2611]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Rotations", "Title",
 CellChangeTimes->{{3.700500832581313*^9, 3.700500843502058*^9}}],

Cell[CellGroupData[{

Cell[BoxData[""], "Input",
 CellChangeTimes->{3.700605342115081*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"CloudObject", "[", 
   TagBox[
    ButtonBox[
     PaneSelectorBox[{
      False->"\<\"https://www.wolframcloud.com/objects/df3a2bf4-dcdf-4788-\
bb00-0ad9d00ba582\"\>", True->
      StyleBox["\<\"https://www.wolframcloud.com/objects/df3a2bf4-dcdf-4788-\
bb00-0ad9d00ba582\"\>", "HyperlinkActive"]}, Dynamic[
       CurrentValue["MouseOver"]],
      BaseStyle->{"Hyperlink"},
      FrameMargins->0,
      ImageSize->Automatic],
     BaseStyle->"Hyperlink",
     ButtonData->{
       URL[
       "https://www.wolframcloud.com/objects/df3a2bf4-dcdf-4788-bb00-\
0ad9d00ba582"], None},
     ButtonNote->
      "https://www.wolframcloud.com/objects/df3a2bf4-dcdf-4788-bb00-\
0ad9d00ba582"],
    Annotation[#, 
     "https://www.wolframcloud.com/objects/df3a2bf4-dcdf-4788-bb00-\
0ad9d00ba582", "Hyperlink"]& ], "]"}],
  CloudObject[
  "https://www.wolframcloud.com/objects/df3a2bf4-dcdf-4788-bb00-0ad9d00ba582"],
  SelectWithContents->True]], "Output",
 CellChangeTimes->{3.700602913191538*^9, 3.700602962748694*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Equation setup", "Section",
 CellChangeTimes->{{3.70058838253695*^9, 3.700588388907529*^9}, {
  3.700588452805987*^9, 3.700588455548293*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Globals", ":", "\[IndentingNewLine]", "lossEq", ":", " ", 
     RowBox[{"equation", " ", "for", " ", "loss", "\[IndentingNewLine]", 
      RowBox[{"errEq", ":", " ", 
       RowBox[{"equation", " ", "for", " ", "error", "\n", "gradEq"}], ":", 
       " ", 
       RowBox[{"equation", " ", "for", " ", "gradient", "\n", 
        RowBox[{"hessEq", ":", " ", 
         RowBox[{"equation", " ", "for", " ", "Hessian", "\n", "pre0"}], ":", 
         " ", 
         RowBox[{"dummy", " ", "preconditioner", "\n", 
          RowBox[{"n", ":", " ", 
           RowBox[{"number", " ", "of", " ", "layers", "\n", 
            RowBox[{"dsize", ":", " ", 
             RowBox[{
             "number", " ", "of", " ", "datapoints"}]}]}]}]}]}]}]}]}]}], ",", 
    " ", 
    RowBox[{"aka", " ", 
     RowBox[{"f", "[", 
      RowBox[{"-", "1"}], "]"}], "\n", 
     RowBox[{"fs", ":", " ", 
      RowBox[{"list", " ", "of", " ", "sizes", "\n", 
       RowBox[{"f", "[", "i", "]"}]}], ":", " ", 
      RowBox[{"gives", " ", "dims"}]}]}], ",", " ", 
    RowBox[{"f", "[", "i", "]"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"i", "-", "1"}], "]"}], " ", "is", " ", "dimension", " ", "of",
       " ", "layer", " ", "i", "\n", 
      RowBox[{"W", "[", 
       RowBox[{"i", ",", "j"}], "]"}]}], ":", " ", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"W", "[", "i", "]"}], ".", 
        RowBox[{"W", "[", 
         RowBox[{"i", "-", "1"}], "]"}]}], ".."}], 
      RowBox[{"W", "[", "j", "]"}], "\n", 
      RowBox[{"U", "[", 
       RowBox[{"i", ",", "j"}], "]"}]}], ":", " ", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"U", "[", "i", "]"}], ".", 
        RowBox[{"U", "[", 
         RowBox[{"i", "+", "1"}], "]"}]}], "..."}], 
      RowBox[{"U", "[", "j", "]"}], "\n", 
      RowBox[{"makeW", "[", "i", "]"}]}], ":", " ", 
     RowBox[{"creates", " ", "matrix", " ", "of", " ", "form", " ", 
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"W", "[", "i", "]"}], "[", 
          RowBox[{"1", ",", "1"}], "]"}], ",", 
         RowBox[{
          RowBox[{"W", "[", "i", "]"}], "[", 
          RowBox[{"1", ",", "2"}], "]"}], ",", 
         RowBox[{"...", "\n", 
          RowBox[{"Y", ":", " ", 
           RowBox[{
           "contains", " ", "array", " ", "of", " ", "outputs", "\n", 
            "vars"}], ":", " ", 
           RowBox[{"contains", " ", "all", " ", 
            RowBox[{"W", "'"}], "s", " ", "except", " ", "W0", " ", 
            RowBox[{"(", 
             RowBox[{"same", " ", "as", " ", "X"}], ")"}], "\n", "allvars"}], 
           ":", " ", 
           RowBox[{"contains", " ", "all", " ", 
            RowBox[{"W", "'"}], "s", "\n", 
            RowBox[{"A", "[", "i", "]"}]}]}]}], ",", 
         RowBox[{"B", "[", "i", "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"B", "[", "i", "]"}], ".", 
           RowBox[{
            RowBox[{"A", "[", "i", "]"}], "\[Transpose]"}]}], " ", "define", 
          " ", "activation"}], ",", " ", "backprop", ",", " ", 
         RowBox[{
          RowBox[{"gradient", " ", "for", " ", "layer", " ", "i", "\n", 
           RowBox[{"Bn", "[", "i", "]"}], " ", "truncated", " ", "backprop", 
           " ", "for", " ", 
           RowBox[{"Newton", "'"}], "s", " ", "method", "\n", 
           RowBox[{"hessBlock", "[", 
            RowBox[{"i", ",", "j"}], "]"}], " ", "gives", " ", "Hessian", " ",
            "of", " ", "layer", " ", "i", " ", "with", " ", "respect", " ", 
           "to", " ", "layer", " ", "j", "\n", 
           RowBox[{"hess", "[", 
            RowBox[{"i", ",", "j"}], "]"}], " ", "gives", " ", "Mathematica", 
           " ", "derived", " ", "Hessian", " ", "of", " ", "layer", " ", "i", 
           " ", "with", " ", "respect", " ", "to", " ", "layer", " ", "j", 
           "\n", 
           RowBox[{"gradBlock", "[", "i", "]"}], " ", "gives", " ", 
           "gradient", " ", "at", " ", "layer", " ", "i", "\n", 
           RowBox[{"grad", "[", "i", "]"}]}], ":", " ", 
          RowBox[{
          "gives", " ", "Mathematica", " ", "gradient", " ", "of", " ", 
           "layer", " ", "i", "\n", "sub1"}], ":", " ", 
          RowBox[{"replaces", " ", "all", " ", 
           RowBox[{"W", "'"}], "s", " ", "and", " ", 
           RowBox[{"Y", "'"}], "s", " ", "with", " ", 
           RowBox[{"1", "'"}], "s", "\n", 
           RowBox[{"subr", ":", " ", 
            RowBox[{
             RowBox[{"replaces", " ", "all", " ", 
              RowBox[{"W", "'"}], "s", " ", "and", " ", 
              RowBox[{"Y", "'"}], "s", " ", "with", " ", "fixed", " ", 
              "random"}], "-", 
             RowBox[{"looking", " ", "number"}]}]}]}]}]}], "\n"}]}]}]}]}], 
   "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"Number", " ", "of", " ", "features", " ", "per", " ", "layer"}], 
   " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Number", " ", "of", " ", "layers"}], ",", " ", 
    RowBox[{"aka", " ", "number", " ", "of", " ", "matmuls"}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"f", "[", "i", "]"}], " ", "shorthand", " ", "for", " ", 
     "shape"}], ",", " ", 
    RowBox[{
     RowBox[{"W", "[", "i", "]"}], " ", "has", " ", "dimensions", " ", 
     RowBox[{"f", "[", "i", "]"}], 
     RowBox[{"xf", "[", 
      RowBox[{"i", "-", "1"}], "]"}]}]}], " ", "*)"}], "\n", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"-", "1"}], "]"}], " ", "is", " ", "shorthand", " ", "for", " ", 
    "dsize"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Unprotect", "[", 
     RowBox[{
     "lossEq", ",", "errEq", ",", "gradEq", ",", "hessEq", ",", "errF", ",", 
      "lossF", ",", "gradF", ",", "hessF", ",", "pre0", ",", "n", ",", 
      "dsize", ",", "W", ",", "U", ",", "makeW", ",", "Y", ",", "X", ",", 
      "vars", ",", "Wf", ",", "allvars", ",", "A", ",", "B", ",", "Bn", ",", 
      "hessBlock", ",", "hess", ",", "gradBlock", ",", "grad", ",", "sub1", 
      ",", "subr", ",", "y", ",", "f"}], "]"}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "lossEq", ",", "errEq", ",", "gradEq", ",", "hessEq", ",", "n", ",", 
      "dsize", ",", "W", ",", "U", ",", "makeW", ",", "Y", ",", "X", ",", 
      "vars", ",", "allvars", ",", "A", ",", "B", ",", "Bn", ",", "hessBlock",
       ",", "hess", ",", "gradBlock", ",", "grad", ",", "sub1", ",", "subr", 
      ",", "y", ",", "f"}], "]"}], ";"}], "\[IndentingNewLine]", "\n", 
   RowBox[{
    RowBox[{"fs", "=", 
     RowBox[{"{", 
      RowBox[{"10", ",", "2", ",", "2", ",", "2"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"n", "=", 
     RowBox[{
      RowBox[{"Length", "[", "fs", "]"}], "-", "2"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", "i", "}"}], ",", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", " ", 
        RowBox[{"i", "\[LessEqual]", 
         RowBox[{"Length", "[", "fs", "]"}]}], ",", 
        RowBox[{"i", "++"}], ",", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"i", "-", "2"}], "]"}], "=", 
         RowBox[{"fs", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}]}], "]"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dsize", "=", 
     RowBox[{"f", "[", 
      RowBox[{"-", "1"}], "]"}]}], ";"}], "\n", "\n", 
   RowBox[{"(*", " ", 
    RowBox[{"TODO", ":", " ", 
     RowBox[{"seal", " ", 
      RowBox[{"flatten", "/", "unflatten"}]}]}], " ", "*)"}], "\n", 
   RowBox[{
    RowBox[{"Unprotect", "[", 
     RowBox[{"flatten", ",", "unflatten"}], "]"}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"flatten", "[", "Ws_", "]"}], ":=", 
     RowBox[{"c2v", "[", 
      RowBox[{"vec", "/@", "Ws"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"unflatten", "[", "Wf_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"flatVars", ",", "sizes"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"sizes", "=", 
         RowBox[{"Rest", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Times", "@@", "#"}], "&"}], "/@", 
           RowBox[{"Partition", "[", 
            RowBox[{"fs", ",", "2", ",", "1"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"flatVars", "=", 
         RowBox[{"listPartition", "[", 
          RowBox[{"Wf", ",", "sizes"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"unvec", "[", 
           RowBox[{
            RowBox[{"flatVars", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ",", 
            RowBox[{"fs", "[", 
             RowBox[{"[", 
              RowBox[{"i", "+", "2"}], "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "@", "sizes"}]}], "}"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"Protect", "[", 
     RowBox[{"flatten", ",", "unflatten"}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeW", "[", "k_", "]"}], ":=", 
     RowBox[{"Array", "[", 
      RowBox[{
       RowBox[{"W", "[", "k", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"f", "[", "k", "]"}], ",", 
         RowBox[{"f", "[", 
          RowBox[{"k", "-", "1"}], "]"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"vars", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"makeW", "[", "k", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", "1", ",", "n"}], "}"}]}], "]"}]}], ";", " ", 
    RowBox[{"(*", " ", 
     RowBox[{"W1", ",", " ", "W2", ",", " ", "...", ",", " ", "Wn"}], " ", 
     "*)"}], "\[IndentingNewLine]", 
    RowBox[{"Wf", "=", 
     RowBox[{"flatten", "@", "vars"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"allvars", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"makeW", "[", "k", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", "0", ",", "n"}], "}"}]}], "]"}]}], ";", " ", 
    RowBox[{"(*", " ", 
     RowBox[{
     "W0", ",", " ", "W1", ",", " ", "W2", ",", " ", "...", ",", " ", "Wn"}], 
     " ", "*)"}], "\n", "\n", 
    RowBox[{"Y", "=", 
     RowBox[{"Array", "[", 
      RowBox[{"y", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"f", "[", "n", "]"}], ",", 
         RowBox[{"f", "[", 
          RowBox[{"-", "1"}], "]"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"X", "=", 
     RowBox[{"makeW", "[", "0", "]"}]}], ";"}], "\[IndentingNewLine]", "\n", 
   RowBox[{
    RowBox[{"errEq", "=", 
     RowBox[{"Y", "-", 
      RowBox[{"Fold", "[", 
       RowBox[{"Dot", ",", 
        RowBox[{"Reverse", "@", "allvars"}]}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lossEq", "=", 
     RowBox[{
      RowBox[{"1", "/", "2"}], 
      RowBox[{
       RowBox[{"Tr", "[", 
        RowBox[{
         RowBox[{"errEq", "\[Transpose]"}], ".", "errEq"}], "]"}], "/", 
       "dsize"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"gradEq", "=", 
     RowBox[{"D", "[", 
      RowBox[{"lossEq", ",", 
       RowBox[{"{", 
        RowBox[{"Wf", ",", "1"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"hessEq", "=", 
     RowBox[{"D", "[", 
      RowBox[{"lossEq", ",", 
       RowBox[{"{", 
        RowBox[{"Wf", ",", "2"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pre0", "=", 
     RowBox[{"IdentityMatrix", "[", 
      RowBox[{"Length", "@", "Wf"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\n", 
   RowBox[{"(*", " ", 
    RowBox[{"Partial", " ", 
     RowBox[{"products", ".", " ", "Shorthand"}], " ", "notation", " ", "for",
      " ", "doing", " ", "product", " ", "of", " ", "all", " ", "layers", " ",
      "between", " ", "j", " ", "and", " ", "i", " ", 
     RowBox[{
      RowBox[{"(", "inclusive", ")"}], ".", " ", "W"}], " ", "refers", " ", 
     "to", " ", "original", " ", "sums", " ", "and", " ", "U", " ", "is", " ",
      "transpose"}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"W", "[", 
      RowBox[{"i", ",", "j"}], "]"}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"W", "[", "j", "]"}], ".", 
        RowBox[{"W", "[", 
         RowBox[{"j", "-", "1"}], "]"}]}], "..."}], 
      RowBox[{"W", "[", "i", "]"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"W", "[", 
      RowBox[{"bottom_", ",", "top_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"IdentityMatrix", "[", 
       RowBox[{"f", "[", "bottom", "]"}], "]"}], "/;", 
      RowBox[{"bottom", "<", "top"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"W", "[", 
      RowBox[{"bottom_", ",", "top_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "sublist", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Assert", "[", 
         RowBox[{
          RowBox[{"top", "\[LessEqual]", "bottom"}], ",", 
          "\"\<W ordering\>\""}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"sublist", "=", 
         RowBox[{"allvars", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"top", "+", "1"}], ";;", 
            RowBox[{"bottom", "+", "1"}]}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Fold", "[", 
         RowBox[{"Dot", ",", 
          RowBox[{"Reverse", "@", "sublist"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"U", "[", 
      RowBox[{"i", ",", "j"}], "]"}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"U", "[", "i", "]"}], ".", 
        RowBox[{"U", "[", 
         RowBox[{"i", "+", "1"}], "]"}]}], "..."}], 
      RowBox[{"U", "[", "j", "]"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"U", "[", 
     RowBox[{"bottom_", ",", "top_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"IdentityMatrix", "[", 
      RowBox[{"f", "[", "top", "]"}], "]"}], "/;", 
     RowBox[{"bottom", ">", "top"}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"U", "[", 
      RowBox[{"bottom_", ",", "top_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "sublist", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Assert", "[", 
         RowBox[{
          RowBox[{"bottom", "\[LessEqual]", "top"}], ",", 
          "\"\<U ordering\>\""}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"sublist", "=", 
         RowBox[{"Transpose", "/@", 
          RowBox[{"allvars", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"bottom", "+", "1"}], ";;", 
             RowBox[{"top", "+", "1"}]}], "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Fold", "[", 
         RowBox[{"Dot", ",", "sublist"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Activation", " ", "at", " ", "layer", " ", 
      RowBox[{"i", ".", " ", "Defines"}], " ", "derivative", " ", "for", " ", 
      "layer", " ", 
      RowBox[{"i", ".", " ", 
       RowBox[{"A", "[", "0", "]"}]}]}], "=", 
     RowBox[{"Identit", "[", "dsize", "]"}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"A", "[", "i_", "]"}], ":=", 
     RowBox[{"W", "[", 
      RowBox[{
       RowBox[{"i", "-", "1"}], ",", "0"}], "]"}]}], ";"}], "          ", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Backprop", " ", "at", " ", "layer", " ", 
      RowBox[{"i", ".", " ", "Defines"}], " ", "derivative", " ", "for", " ", 
      "layer", " ", 
      RowBox[{"i", ".", " ", 
       RowBox[{"B", "[", "n", "]"}]}]}], "=", "d_error"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"B", "[", "i_", "]"}], ":=", 
     RowBox[{
      RowBox[{"-", 
       RowBox[{
        RowBox[{"U", "[", 
         RowBox[{
          RowBox[{"i", "+", "1"}], ",", "n"}], "]"}], ".", "errEq"}]}], "/", 
      "dsize"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Partial", " ", "products", " ", "needed", " ", "for", " ", 
     RowBox[{"Newton", "'"}], "s", " ", "method"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Bn", "[", "i_", "]"}], ":=", 
     RowBox[{"U", "[", 
      RowBox[{
       RowBox[{"i", "+", "1"}], ",", "n"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"hessBlock", "[", 
      RowBox[{"i_", ",", "j_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"term1", ",", "term2"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"term1", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"A", "[", "i", "]"}], ".", 
             RowBox[{
              RowBox[{"A", "[", "j", "]"}], "\[Transpose]"}]}], ")"}], 
           "\[TensorProduct]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Bn", "[", "i", "]"}], ".", 
             RowBox[{
              RowBox[{"Bn", "[", "j", "]"}], "\[Transpose]"}]}], ")"}]}], "/",
           "dsize"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Assert", "[", 
         RowBox[{
          RowBox[{"Dimensions", "@", "term1"}], "\[Equal]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"f", "[", "i", "]"}], "*", 
             RowBox[{"f", "[", 
              RowBox[{"i", "-", "1"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"f", "[", "j", "]"}], "*", 
             RowBox[{"f", "[", 
              RowBox[{"j", "-", "1"}], "]"}]}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"term2", "=", 
         RowBox[{"Which", "[", "\n", 
          RowBox[{
           RowBox[{"i", "\[Equal]", "j"}], ",", 
           RowBox[{"Array", "[", 
            RowBox[{
             RowBox[{"0", "&"}], ",", 
             RowBox[{"Dimensions", "[", "term1", "]"}]}], "]"}], ",", "\n", 
           RowBox[{"i", "<", "j"}], ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"A", "[", "i", "]"}], ".", 
              RowBox[{
               RowBox[{"B", "[", "j", "]"}], "\[Transpose]"}]}], ")"}], 
            "\[TensorProduct]", 
            RowBox[{"U", "[", 
             RowBox[{
              RowBox[{"i", "+", "1"}], ",", 
              RowBox[{"j", "-", "1"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"i", ">", "j"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"U", "[", 
              RowBox[{
               RowBox[{"j", "+", "1"}], ",", 
               RowBox[{"i", "-", "1"}]}], "]"}], "\[Transpose]"}], 
            "\[TensorProduct]", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"B", "[", "i", "]"}], ".", 
              RowBox[{
               RowBox[{"A", "[", "j", "]"}], "\[Transpose]"}]}], ")"}]}]}], 
          "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(", 
         RowBox[{"term1", "+", 
          RowBox[{"term2", ".", 
           RowBox[{"Kmat", "[", 
            RowBox[{
             RowBox[{"f", "[", "j", "]"}], ",", 
             RowBox[{"f", "[", 
              RowBox[{"j", "-", "1"}], "]"}]}], "]"}]}]}], ")"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"gradBlock", "[", "i_", "]"}], ":=", 
     RowBox[{"c2v", "@", 
      RowBox[{"vec", "[", 
       RowBox[{
        RowBox[{"B", "[", "i", "]"}], ".", 
        RowBox[{
         RowBox[{"A", "[", "i", "]"}], "\[Transpose]"}]}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "substitutes", " ", "1", " ", "to", " ", "every", " ", "variable"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sub1", ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"everything", "=", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"vec", "/@", "allvars"}], "]"}], "~", "Join", "~", 
          RowBox[{"c2v", "@", 
           RowBox[{"vec", "@", "Y"}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Thread", "[", 
         RowBox[{"everything", "\[Rule]", 
          RowBox[{"Array", "[", 
           RowBox[{
            RowBox[{"1", "&"}], ",", 
            RowBox[{"Length", "@", "everything"}]}], "]"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "substitutes", " ", "random", " ", "value", " ", "to", " ", "every", " ", 
     "variable"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"subr", ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"SeedRandom", "[", "0", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"everything", "=", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"vec", "/@", "allvars"}], "]"}], "~", "Join", "~", 
          RowBox[{"c2v", "@", 
           RowBox[{"vec", "@", "Y"}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Thread", "[", 
         RowBox[{"everything", "\[Rule]", 
          RowBox[{"RandomReal", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
            RowBox[{"Length", "@", "everything"}]}], "]"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\n", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Functional", " ", "versions", " ", "of", " ", "equations"}], " ",
     "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"errF", "[", "W_", "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"errEq", "/.", "subX"}], "/.", "subY"}], "/.", 
      RowBox[{"subW", "[", "W", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"lossF", "[", "W_", "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"lossEq", "/.", "subX"}], "/.", "subY"}], "/.", 
      RowBox[{"subW", "[", "W", "]"}]}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"gradF", "[", "W_", "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"gradEq", "/.", "subX"}], "/.", "subY"}], "/.", 
      RowBox[{"subW", "[", "W", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"hessF", "[", "W_", "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"hessEq", "/.", "subX"}], "/.", "subY"}], "/.", 
      RowBox[{"subW", "[", "W", "]"}]}]}], ";"}], "\n", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Run", " ", "checks"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"grad", "[", "i_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", 
       RowBox[{
        RowBox[{"Assert", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"i", "\[GreaterEqual]", "0"}], " ", "&&", " ", 
           RowBox[{"i", "\[LessEqual]", "n"}]}], ",", 
          "\"\<grad i check\>\""}], "]"}], ";", "\n", 
        RowBox[{"D", "[", 
         RowBox[{"lossEq", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"c2v", "@", 
             RowBox[{"vec", "@", 
              RowBox[{"allvars", "[", 
               RowBox[{"[", 
                RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", "1"}], 
           "}"}]}], "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"hess", "[", 
      RowBox[{"i_", ",", "j_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", 
       RowBox[{
        RowBox[{"Assert", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"j", "\[GreaterEqual]", "0"}], "&&", 
           RowBox[{"j", "\[LessEqual]", "n"}]}], ",", 
          "\"\<hess j check\>\""}], "]"}], ";", "\n", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"grad", "[", "i", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"c2v", "@", 
             RowBox[{"vec", "@", 
              RowBox[{"allvars", "[", 
               RowBox[{"[", 
                RowBox[{"j", "+", "1"}], "]"}], "]"}]}]}], ",", "1"}], 
           "}"}]}], "]"}]}]}], "]"}]}], ";"}], "\n", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Protect", "[", 
     RowBox[{
     "lossEq", ",", "errEq", ",", "gradEq", ",", "hessEq", ",", "errF", ",", 
      "lossF", ",", "gradF", ",", "hessF", ",", "pre0", ",", "n", ",", 
      "dsize", ",", "W", ",", "U", ",", "makeW", ",", "Y", ",", "X", ",", 
      "vars", ",", "Wf", ",", "allvars", ",", "A", ",", "B", ",", "Bn", ",", 
      "hessBlock", ",", "hess", ",", "gradBlock", ",", "grad", ",", "sub1", 
      ",", "subr", ",", "y", ",", "f"}], "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"idx", "=", 
     RowBox[{
      RowBox[{"Range", "[", 
       RowBox[{"n", "+", "1"}], "]"}], "-", "1"}]}], ";", " ", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{"all", " ", "valid", " ", "layer", " ", "indices"}], ",", " ", 
      RowBox[{"including", " ", "W0"}]}], " ", "*)"}], "\[IndentingNewLine]", 
    
    RowBox[{"blockIdx", "=", 
     RowBox[{"Outer", "[", 
      RowBox[{"List", ",", "idx", ",", "idx"}], "]"}]}], ";"}], "\n", "\n", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "Checks", " ", "correctness", " ", "of", " ", "block", " ", "i"}], ",", 
     "j"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"hessCheck", "[", 
      RowBox[{"i_", ",", "j_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"hess", "[", 
        RowBox[{"i", ",", "j"}], "]"}], "\[DotEqual]", 
       RowBox[{"hessBlock", "[", 
        RowBox[{"i", ",", "j"}], "]"}]}], "/.", "subr"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"gradCheck", "[", "i_", "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"grad", "[", "i", "]"}], "\[Equal]", 
       RowBox[{"gradBlock", "[", "i", "]"}]}], "/.", "subr"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"gradCheck", "/@", "idx"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Apply", "[", 
     RowBox[{"hessCheck", ",", " ", "blockIdx", ",", 
      RowBox[{"{", "2", "}"}]}], "]"}], "//", "MatrixForm"}]}]}]], "Code",
 InitializationCell->False,
 CellChangeTimes->{{3.700571573211966*^9, 3.700571608458366*^9}, {
   3.700571649737393*^9, 3.7005717501412477`*^9}, {3.700571808755176*^9, 
   3.70057216687712*^9}, {3.700572202138546*^9, 3.700572253390592*^9}, {
   3.7005723022639217`*^9, 3.700572371418867*^9}, {3.700572402151071*^9, 
   3.700572455048044*^9}, {3.700572567518448*^9, 3.700572754142886*^9}, {
   3.700572810225112*^9, 3.7005728602981453`*^9}, {3.70057289065069*^9, 
   3.700572890946741*^9}, {3.700572921173587*^9, 3.7005729222743998`*^9}, {
   3.7005729709572287`*^9, 3.7005729755772753`*^9}, {3.7005731418669243`*^9, 
   3.7005731540689707`*^9}, {3.700573211909589*^9, 3.7005733452075787`*^9}, {
   3.700573413486807*^9, 3.700573418277412*^9}, {3.700573453985981*^9, 
   3.7005734733931427`*^9}, {3.700573547541644*^9, 3.700573552323368*^9}, {
   3.700574112318883*^9, 3.700574176070272*^9}, {3.700574864857162*^9, 
   3.700574885081049*^9}, {3.7005749238059673`*^9, 3.7005749267759933`*^9}, {
   3.700575034080513*^9, 3.700575061451045*^9}, {3.700575121561865*^9, 
   3.7005755161641912`*^9}, {3.7005755793016853`*^9, 3.700575624964334*^9}, {
   3.7005756693026867`*^9, 3.700575691205001*^9}, {3.7005760474053087`*^9, 
   3.7005761379233217`*^9}, {3.700576253485662*^9, 3.700576278436417*^9}, {
   3.700576407713912*^9, 3.7005764546915073`*^9}, {3.700576506600729*^9, 
   3.700576543566834*^9}, {3.700576586169359*^9, 3.700576646617703*^9}, {
   3.700576685206921*^9, 3.700576981153141*^9}, {3.7005770199853573`*^9, 
   3.7005770584908323`*^9}, {3.700577148078855*^9, 3.700577148831902*^9}, {
   3.700577253165867*^9, 3.700577274414756*^9}, {3.70057737025662*^9, 
   3.700577498505063*^9}, {3.700577539603736*^9, 3.7005777409467382`*^9}, {
   3.7005777770595627`*^9, 3.7005777879017897`*^9}, {3.700578411911454*^9, 
   3.7005784203161087`*^9}, {3.70057856786343*^9, 3.7005785725387497`*^9}, {
   3.700578638601763*^9, 3.700578782408634*^9}, {3.700585037878829*^9, 
   3.700585100910795*^9}, 3.700586926693211*^9, {3.700586958033395*^9, 
   3.70058696380774*^9}, {3.700587190730864*^9, 3.700587223683158*^9}, {
   3.700588395690563*^9, 3.7005883962178793`*^9}, {3.700589262843753*^9, 
   3.7005892953804197`*^9}, {3.700589340806072*^9, 3.700589529030208*^9}, {
   3.700589577767243*^9, 3.7005896184034777`*^9}, {3.700589650418445*^9, 
   3.700589670793825*^9}, {3.700590294957735*^9, 3.700590410091864*^9}, {
   3.700590536272386*^9, 3.700590562788404*^9}, {3.70059068797968*^9, 
   3.700590757345798*^9}, {3.7005911381735783`*^9, 3.7005911755436497`*^9}, {
   3.700591407599194*^9, 3.7005914335770597`*^9}, {3.7005915203038473`*^9, 
   3.7005915528941317`*^9}, 3.700597059725874*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"True", ",", "True", ",", "True"}], "}"}]], "Output",
 CellChangeTimes->{{3.7005892880258904`*^9, 3.70058930006528*^9}, 
   3.700589396288341*^9, 3.700589493544114*^9, 3.700589532502977*^9, 
   3.700589673773287*^9, 3.700590328481139*^9, 3.7005903813033257`*^9, 
   3.700590411707672*^9, 3.700590563362154*^9, 3.700590759337379*^9, 
   3.700591176129065*^9, 3.7005914346844263`*^9, 3.700591554267022*^9, 
   3.7005970625599537`*^9}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"True", "True", "True"},
     {"True", "True", "True"},
     {"True", "True", "True"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{{3.7005892880258904`*^9, 3.70058930006528*^9}, 
   3.700589396288341*^9, 3.700589493544114*^9, 3.700589532502977*^9, 
   3.700589673773287*^9, 3.700590328481139*^9, 3.7005903813033257`*^9, 
   3.700590411707672*^9, 3.700590563362154*^9, 3.700590759337379*^9, 
   3.700591176129065*^9, 3.7005914346844263`*^9, 3.700591554267022*^9, 
   3.7005970627131777`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Data setup", "Section",
 CellChangeTimes->{{3.700588463106616*^9, 3.700588465240594*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"generateX", "[", 
    RowBox[{"n_", ",", "e_", ",", "dsize_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"wt", ",", "mean", ",", "cov", ",", "normal", ",", "X"}], "}"}],
      ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"SeedRandom", "[", "0", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"mean", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0", ",", 
         RowBox[{"{", "n", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cov", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"IdentityMatrix", "[", "n", "]"}], "*", "e"}], "+", 
        RowBox[{"Array", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"1", "-", "e"}], "&"}], ",", 
          RowBox[{"{", 
           RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"normal", "=", 
       RowBox[{"MultinormalDistribution", "[", 
        RowBox[{"mean", ",", "cov"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"X", "=", 
       RowBox[{
        RowBox[{"RandomVariate", "[", 
         RowBox[{"normal", ",", 
          RowBox[{"{", "dsize", "}"}]}], "]"}], "//", "Transpose"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"centerData", "[", "X", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"SeedRandom", "[", "0", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"X0", "=", 
   RowBox[{"generateX", "[", 
    RowBox[{
     RowBox[{"f", "[", "0", "]"}], ",", "0.01", ",", "dsize"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Theta]0", "=", 
   RowBox[{"Pi", "/", "20"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Y0", "=", 
    RowBox[{
     RowBox[{"RotationMatrix", "[", "\[Theta]0", "]"}], ".", "X0"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{
     "\"\<~/git/whitening/exp/data/rotations_simple_X0.csv\>\"", ",", "X0"}], 
     "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{
     "\"\<~/git/whitening/exp/data/rotations_simple_Y0.csv\>\"", ",", "Y0"}], 
     "]"}], ";"}], "*)"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makeInitializer", "[", "k_", "]"}], ":=", 
   RowBox[{"truncatedIdentity", "[", 
    RowBox[{
     RowBox[{"f", "[", "k", "]"}], ",", 
     RowBox[{"f", "[", 
      RowBox[{"k", "-", "1"}], "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"W0s", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"makeInitializer", "[", "k", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", "n"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"W0f", "=", 
    RowBox[{"flatten", "@", "W0s"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{
     "\"\<~/git/whitening/exp/data/rotations_simple_W0f.csv\>\"", ",", 
      "W0f"}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{
     "\"\<~/git/whitening/exp/data/rotations_simple_fs.csv\>\"", ",", "fs"}], 
     "]"}], ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"Todo", ":", " ", 
    RowBox[{"refactor", " ", "into", " ", "helper", " ", "functions"}]}], " ",
    "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"subX", ":=", 
   RowBox[{"Thread", "[", 
    RowBox[{
     RowBox[{"Flatten", "@", "X"}], "\[Rule]", 
     RowBox[{"Flatten", "@", "X0"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"subY", ":=", 
   RowBox[{"Thread", "[", 
    RowBox[{
     RowBox[{"Flatten", "@", "Y"}], "\[Rule]", 
     RowBox[{"Flatten", "@", "Y0"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"subW", "[", "Wfval_", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Assert", "[", 
      RowBox[{
       RowBox[{"Length", "@", "Wfval"}], "\[Equal]", 
       RowBox[{"Length", "@", "Wf"}]}], "]"}], ";", 
     RowBox[{"Thread", "[", 
      RowBox[{"Wf", "\[Rule]", "Wfval"}], "]"}]}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"subW0", ":=", 
   RowBox[{"subW", "[", "W0f", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7005884883669167`*^9, 3.7005885599733353`*^9}, {
   3.700588869596386*^9, 3.700588874321349*^9}, {3.70058894512924*^9, 
   3.700588948425765*^9}, {3.700589117053347*^9, 3.700589176620331*^9}, {
   3.700589309833583*^9, 3.700589311238286*^9}, 3.70058954865143*^9, 
   3.70058970202309*^9, {3.700589831106209*^9, 3.700589855392948*^9}, {
   3.700590138211431*^9, 3.700590142777382*^9}, {3.700597118558473*^9, 
   3.700597140406551*^9}, {3.7005971809615917`*^9, 3.70059718967113*^9}, {
   3.700597260681491*^9, 3.7005972658562202`*^9}, {3.700597452507214*^9, 
   3.700597463314937*^9}, {3.700597843277192*^9, 3.700597846224703*^9}, {
   3.7005982955634117`*^9, 3.7005982973735123`*^9}, {3.7006060307518682`*^9, 
   3.70060604191295*^9}}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.700589916818342*^9, 3.700589973243835*^9}, {
   3.700590103086852*^9, 3.700590253106618*^9}, {3.7005904213609667`*^9, 
   3.700590432103702*^9}, {3.700590512801*^9, 3.7005905308022118`*^9}, {
   3.7005905713129263`*^9, 3.700590625224907*^9}, {3.700597091751734*^9, 
   3.700597093269944*^9}, 3.7005971795343447`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Optimizer setup", "Section",
 CellChangeTimes->{{3.700591671252442*^9, 3.700591674329764*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Applies", " ", "single", " ", "step", " ", "of", " ", "optimization"}], 
   " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"step", "[", 
      RowBox[{"x_", ",", "lr_", ",", "pre_", ",", "grad_", ",", "lossFunc_"}],
       "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pointList", "=", 
         RowBox[{"pointList", "~", "Append", "~", "x"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"gradList", "=", 
         RowBox[{"gradList", "~", "Append", "~", "grad"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"preList", "=", 
         RowBox[{"preList", "~", "Append", "~", "pre"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"lossList", "=", 
         RowBox[{"lossList", "~", "Append", "~", 
          RowBox[{"lossFunc", "[", "x", "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"x", "-", 
         RowBox[{"lr", "*", 
          RowBox[{"pre", ".", "grad"}]}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"resetStep", ":=", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "pointList", ",", " ", "gradList", ",", "preList", ",", " ", 
          "lossList"}], "}"}], "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", "}"}]}], "}"}]}], ";", "W0f"}], ")"}]}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.700591706849535*^9, 3.700591714014675*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Optimizer experiments", "Section",
 CellChangeTimes->{{3.700591718660655*^9, 3.700591721084391*^9}}],

Cell[CellGroupData[{

Cell["Gradient Descent", "Subsection",
 CellChangeTimes->{{3.7005917502542553`*^9, 3.700591760953086*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"optimizeGradient", "[", 
    RowBox[{"lr_", ",", "iters_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "w", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"w", "=", "resetStep"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"iter", "=", "1"}], ",", 
        RowBox[{"iter", "\[LessEqual]", "iters"}], ",", 
        RowBox[{"iter", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"w", "=", 
         RowBox[{"step", "[", 
          RowBox[{"w", ",", "lr", ",", "pre0", ",", 
           RowBox[{"gradF", "[", "w", "]"}], ",", "lossF"}], "]"}]}]}], 
       "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"optimizeGradient", "[", 
    RowBox[{"1.", ",", "20"}], "]"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{
     "\"\<~/git/whitening/exp/data/rotations_simple_gradient_losses.csv\>\"", 
      ",", "lossList"}], "]"}], ";"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"ListPlot", "[", 
  RowBox[{"lossList", ",", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.700591723522081*^9, 3.7005917343542852`*^9}, {
  3.700596999916737*^9, 3.700597043318482*^9}, {3.700598151854013*^9, 
  3.7005981808563557`*^9}, {3.700606015555622*^9, 3.700606016464902*^9}}],

Cell[BoxData[
 GraphicsBox[{{}, {{}, 
    {RGBColor[0.368417, 0.506779, 0.709798], PointSize[0.012833333333333334`],
      AbsoluteThickness[1.6], PointBox[CompressedData["
1:eJxTTMoPSmViYGAQAWIQDQEf7G9MLr2582qbPVTAoem2sfnq0hoon8Ph8eoY
NcfphVC+gMNbz4RdO0NToHwRhx9B9kpSMlFQvoTDouUKLqXx/lC+jIP6qVrz
sihXKF/Bwb5jyjqzY9ZQvpLDI9OoI6lSJlC+isMvIYvZ1Z06UL6ag3Q7Xxg7
sxqUr+FwaM7Wu02cilC+loPuseJPC/lkoHwdh3JxPt8JNeJQvp6D/f1p251b
RaB8A4fD4euNDZyEoHxDh9cic547rReA8o0clsyMF85+xQflGzt8Lz7MnCjM
C+WbOPx1X+g7fQq3PQBzzEvs
      "]]}, {}}, {}, {}, {{}, {}}},
  AspectRatio->NCache[GoldenRatio^(-1), 0.6180339887498948],
  Axes->{True, True},
  AxesLabel->{None, None},
  AxesOrigin->{0.703125, 0},
  DisplayFunction->Identity,
  Frame->{{False, False}, {False, False}},
  FrameLabel->{{None, None}, {None, None}},
  FrameTicks->{{Automatic, Automatic}, {Automatic, Automatic}},
  GridLines->{None, None},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImagePadding->All,
  Method->{"CoordinatesToolOptions" -> {"DisplayFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& ), "CopiedValueFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& )}},
  PlotRange->{{1., 20.}, {0, 0.011149837445097718`}},
  PlotRangeClipping->True,
  PlotRangePadding->{{
     Scaled[0.02], 
     Scaled[0.02]}, {
     Scaled[0.02], 
     Scaled[0.05]}},
  Ticks->{Automatic, Automatic}]], "Output",
 CellChangeTimes->{
  3.700591734918679*^9, {3.7005970012360163`*^9, 3.70059700763542*^9}, 
   3.700597044679034*^9, 3.7005972062987432`*^9, 3.7005978647959433`*^9, {
   3.70059815383001*^9, 3.7005981816485786`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["lossList"], "Input",
 CellChangeTimes->{{3.7005985289134893`*^9, 3.7005985301687193`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "0.011149837445097718`", ",", "0.006948155222963661`", ",", 
   "0.0042946381488872835`", ",", "0.002482283353864681`", ",", 
   "0.0015936141216929527`", ",", "0.0009574244106762451`", ",", 
   "0.0006516530256546791`", ",", "0.0004238017559875552`", ",", 
   "0.00030674919649062275`", ",", "0.00021772035471214602`", ",", 
   "0.00016793694069599453`", ",", "0.00012998316274634962`", ",", 
   "0.00010702956625487847`", ",", "0.00008959418052087257`", ",", 
   "0.00007827974140794685`", ",", "0.00006965083313956095`", ",", 
   "0.00006364675382649106`", ",", "0.00005896701115641896`", ",", 
   "0.00005545749488231743`", ",", "0.00005260550251819094`"}], 
  "}"}]], "Output",
 CellChangeTimes->{3.700598530402996*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Newton's method", "Subsection",
 CellChangeTimes->{{3.700591766048594*^9, 3.700591774395926*^9}, 
   3.700591894576791*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{
     "\"\<~/git/whitening/exp/data/rotations_simple_newton_hess0.csv\>\"", 
      ",", 
      RowBox[{"hessF", "[", "W0f", "]"}]}], "]"}], ";"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{
     "\"\<~/git/whitening/exp/data/rotations_simple_newton_ihess0.csv\>\"", 
      ",", 
      RowBox[{"ihessF", "[", "W0f", "]"}]}], "]"}], ";"}], "*)"}]}]], "Input",\

 CellChangeTimes->{{3.700600978282961*^9, 3.7006009928159943`*^9}, {
  3.7006013457762957`*^9, 3.7006013509175863`*^9}, {3.700606048707678*^9, 
  3.700606052217361*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ihessF", "[", "W_", "]"}], ":=", 
   RowBox[{"PseudoInverse", "@", 
    RowBox[{"hessF", "@", "W"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"optimizeNewton", "[", 
    RowBox[{"lr_", ",", "iters_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "w", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"w", "=", "resetStep"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"iter", "=", "1"}], ",", 
        RowBox[{"iter", "\[LessEqual]", "iters"}], ",", 
        RowBox[{"iter", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"w", "=", 
         RowBox[{"step", "[", 
          RowBox[{"w", ",", "lr", ",", 
           RowBox[{"ihessF", "[", "w", "]"}], ",", 
           RowBox[{"gradF", "[", "w", "]"}], ",", "lossF"}], "]"}]}]}], 
       "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"optimizeNewton", "[", 
    RowBox[{"1.", ",", "10"}], "]"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{
     "\"\<~/git/whitening/exp/data/rotations_simple_newton_losses.csv\>\"", 
      ",", "lossList"}], "]"}], ";"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"ListPlot", "[", 
  RowBox[{"lossList", ",", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.7005917804920893`*^9, 3.7005918720000153`*^9}, {
  3.7006024990293427`*^9, 3.700602501934108*^9}, {3.700602665069687*^9, 
  3.700602671156176*^9}, {3.700606021887569*^9, 3.700606023090884*^9}}],

Cell[BoxData[
 GraphicsBox[{{}, {{}, 
    {RGBColor[0.368417, 0.506779, 0.709798], PointSize[0.012833333333333334`],
      AbsoluteThickness[1.6], 
     PointBox[{{1., 0.011149837445097718`}, {2., 0.030865770418542694`}, {3., 
      0.004625711296960099}, {4., 0.00002512293544325525}, {5., 
      1.3850774798914361`*^-9}, {6., 1.3238274753020383`*^-17}, {7., 
      2.3911924892336586`*^-31}, {8., 2.055749659701088*^-32}, {9., 
      1.7888578991265507`*^-33}, {10., 
      1.7888578991265507`*^-33}}]}, {}}, {}, {}, {{}, {}}},
  AspectRatio->NCache[GoldenRatio^(-1), 0.6180339887498948],
  Axes->{True, True},
  AxesLabel->{None, None},
  AxesOrigin->{0.8593750000000001, 0},
  DisplayFunction->Identity,
  Frame->{{False, False}, {False, False}},
  FrameLabel->{{None, None}, {None, None}},
  FrameTicks->{{Automatic, Automatic}, {Automatic, Automatic}},
  GridLines->{None, None},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImagePadding->All,
  Method->{"CoordinatesToolOptions" -> {"DisplayFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& ), "CopiedValueFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& )}},
  PlotRange->{{1., 10.}, {0, 0.030865770418542694`}},
  PlotRangeClipping->True,
  PlotRangePadding->{{
     Scaled[0.02], 
     Scaled[0.02]}, {
     Scaled[0.02], 
     Scaled[0.05]}},
  Ticks->{Automatic, Automatic}]], "Output",
 CellChangeTimes->{{3.700591842653554*^9, 3.7005918970893784`*^9}, {
   3.700602488125052*^9, 3.700602502801003*^9}, 3.700602672172426*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["lossList"], "Input",
 CellChangeTimes->{{3.7006024835998173`*^9, 3.700602485686352*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "0.011149837445097718`", ",", "0.030865770418542694`", ",", 
   "0.004625711296960099`", ",", "0.00002512293544325525`", ",", 
   "1.3850774798914361`*^-9", ",", "1.3238274753020383`*^-17", ",", 
   "2.3911924892336586`*^-31", ",", "2.055749659701088`*^-32", ",", 
   "1.7888578991265507`*^-33", ",", "1.7888578991265507`*^-33"}], 
  "}"}]], "Output",
 CellChangeTimes->{3.700602489446802*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Newton' s method with own implementation", "Subsection",
 CellChangeTimes->{{3.700591918979187*^9, 3.700591933272175*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"myHess0", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"hessBlock", "[", 
      RowBox[{"i", ",", "j"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "n"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", "n"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"myhessF", "[", "W_", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"ArrayFlatten", "[", "myHess0", "]"}], "/.", "subX"}], "/.", 
     "subY"}], "/.", 
    RowBox[{"subW", "[", "W", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"myihessF", "[", "W_", "]"}], ":=", 
   RowBox[{"PseudoInverse", "[", 
    RowBox[{"myhessf", "[", "W", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ihessF", "[", "W0f", "]"}], "\[DotEqual]", 
  RowBox[{"myihessF", "[", "W0f", "]"}]}]}], "Input",
 CellChangeTimes->{{3.7005923670631723`*^9, 3.700592374583638*^9}, {
  3.700592493690999*^9, 3.70059256557535*^9}, {3.700592901650091*^9, 
  3.700592901851243*^9}}],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{3.70059290403487*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"optimizeNewton2", "[", 
    RowBox[{"lr_", ",", "iters_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "w", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"w", "=", "resetStep"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"iter", "=", "1"}], ",", 
        RowBox[{"iter", "\[LessEqual]", "iters"}], ",", 
        RowBox[{"iter", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"w", "=", 
         RowBox[{"step", "[", 
          RowBox[{"w", ",", "lr", ",", 
           RowBox[{"myihessF", "[", "w", "]"}], ",", 
           RowBox[{"gradF", "[", "w", "]"}], ",", "lossF"}], "]"}]}]}], 
       "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"optimizeNewton2", "[", 
   RowBox[{"1.", ",", "10"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"ListPlot", "[", "lossList", "]"}]}], "Input",
 CellChangeTimes->{{3.700592914058037*^9, 3.7005929234848413`*^9}}],

Cell[BoxData[
 GraphicsBox[{{}, {{}, 
    {RGBColor[0.368417, 0.506779, 0.709798], PointSize[0.012833333333333334`],
      AbsoluteThickness[1.6], 
     PointBox[{{1., 0.011149837445097718`}, {2., 0.030865770418544075`}, {3., 
      0.004625711296960005}, {4., 0.00002512293544326222}, {5., 
      1.3850774801436398`*^-9}, {6., 1.3238273763299354`*^-17}, {7., 
      2.0737450676189564`*^-32}, {8., 3.9317408424834706`*^-32}, {9., 
      1.0358644298542129`*^-32}, {10., 
      3.21705532351121*^-33}}]}, {}}, {}, {}, {{}, {}}},
  AspectRatio->NCache[GoldenRatio^(-1), 0.6180339887498948],
  Axes->{True, True},
  AxesLabel->{None, None},
  AxesOrigin->{0., 0},
  DisplayFunction->Identity,
  Frame->{{False, False}, {False, False}},
  FrameLabel->{{None, None}, {None, None}},
  FrameTicks->{{Automatic, Automatic}, {Automatic, Automatic}},
  GridLines->{None, None},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImagePadding->All,
  Method->{"CoordinatesToolOptions" -> {"DisplayFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& ), "CopiedValueFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& )}},
  PlotRange->{{0., 10.}, {0, 0.011564278242400014`}},
  PlotRangeClipping->True,
  PlotRangePadding->{{
     Scaled[0.02], 
     Scaled[0.02]}, {
     Scaled[0.02], 
     Scaled[0.05]}},
  Ticks->{Automatic, Automatic}]], "Output",
 CellChangeTimes->{3.700592924455564*^9}]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Simple Newton", "Section",
 CellChangeTimes->{{3.700500825448949*^9, 3.7005008285120277`*^9}, {
  3.7005009583096437`*^9, 3.700500958915991*^9}, {3.700511229659986*^9, 
  3.700511230941443*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{"pointList", ",", "gradList", ",", "preList", ",", "lossList"}], 
    "]"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"takes", " ", "loss"}], ",", " ", "grad", ",", " ", 
    RowBox[{"learning", " ", "rate"}], ",", " ", 
    RowBox[{"produces", " ", "list", " ", "of", " ", "losses"}]}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"globals", ":", " ", "points"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"optimizeNewton", "[", 
    RowBox[{"lr_", ",", "w0f_", ",", "iters_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "wf", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pointList", ",", " ", "gradList", ",", "preList", ",", " ", 
         "lossList"}], "}"}], "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", "}"}], ",", 
         RowBox[{"{", "}"}], ",", 
         RowBox[{"{", "}"}], ",", 
         RowBox[{"{", "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wf", "=", "w0f"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"iter", "=", "1"}], ",", 
        RowBox[{"iter", "\[LessEqual]", "iters"}], ",", 
        RowBox[{"iter", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"pointList", "=", 
          RowBox[{"pointList", "~", "Append", "~", "wf"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"gradList", "=", 
          RowBox[{"gradList", "~", "Append", "~", 
           RowBox[{"gradf", "[", "wf", "]"}]}]}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"preList", "=", 
          RowBox[{"preList", "~", "Append", "~", 
           RowBox[{"ihessf", "[", "wf", "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"lossList", "=", 
          RowBox[{"lossList", "~", "Append", "~", 
           RowBox[{"lossf", "[", "wf", "]"}]}]}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"wf", "=", 
          RowBox[{"wf", "-", 
           RowBox[{"lr", "*", 
            RowBox[{
             RowBox[{"ihessf", "[", "wf", "]"}], ".", 
             RowBox[{"gradf", "[", "wf", "]"}]}]}]}]}]}]}], 
       "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"optimizeNewton", "[", 
   RowBox[{"1.", ",", "W0f", ",", "20"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
   "\"\<~/git/whitening/exp/data/rotations_simple_losses_newton.csv\>\"", ",",
     "lossList"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"ListPlot", "[", 
  RowBox[{"lossList", ",", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.700499901323206*^9, 3.700499906789361*^9}, {
   3.7005050617196417`*^9, 3.7005050982685003`*^9}, {3.700511353299275*^9, 
   3.700511354096363*^9}, 3.700512148295794*^9, {3.700512239950934*^9, 
   3.700512250569817*^9}, {3.700512292497909*^9, 3.7005122926209106`*^9}, {
   3.700512326768895*^9, 3.700512351252952*^9}, {3.700512441698002*^9, 
   3.700512442799589*^9}, {3.700513794830015*^9, 3.700513818230117*^9}}],

Cell[BoxData[
 GraphicsBox[{{}, {{}, 
    {RGBColor[0.368417, 0.506779, 0.709798], PointSize[0.012833333333333334`],
      AbsoluteThickness[1.6], PointBox[CompressedData["
1:eJxTTMoPSmViYGAQAWIQDQEf7I1bGaW6hE7YQwUcjOo7ks7+Om4J4XI4HPwa
2h8yXQjKF3B4fP6MdemhDxYQvohD6VK3N0sCtKHyEg785U2vb13VhfJlHIxf
v7T7cfYxVL0CGl8Jja+CxldD42ug8bXQ+DpofD00vgEa3xCNb4TGN0bjm8D5
AKuFabU=
      "]]}, {}}, {}, {}, {{}, {}}},
  AspectRatio->NCache[GoldenRatio^(-1), 0.6180339887498948],
  Axes->{True, True},
  AxesLabel->{None, None},
  AxesOrigin->{0.703125, 0},
  DisplayFunction->Identity,
  Frame->{{False, False}, {False, False}},
  FrameLabel->{{None, None}, {None, None}},
  FrameTicks->{{Automatic, Automatic}, {Automatic, Automatic}},
  GridLines->{None, None},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImagePadding->All,
  ImageSize->{486.69140625, Automatic},
  Method->{"CoordinatesToolOptions" -> {"DisplayFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& ), "CopiedValueFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& )}},
  PlotRange->{{1., 20.}, {0, 0.1880657793981669}},
  PlotRangeClipping->True,
  PlotRangePadding->{{
     Scaled[0.02], 
     Scaled[0.02]}, {
     Scaled[0.02], 
     Scaled[0.05]}},
  Ticks->{Automatic, Automatic}]], "Output",
 CellChangeTimes->{
  3.700494451743908*^9, {3.700499895475957*^9, 3.700499907118189*^9}, 
   3.7005040435488033`*^9, {3.700505090872525*^9, 3.700505098644865*^9}, 
   3.700511328249392*^9, 3.700511385283004*^9, {3.70051204857831*^9, 
   3.700512056729787*^9}, 3.700512102472925*^9, 3.700512152365982*^9, {
   3.700512197971336*^9, 3.700512268339094*^9}, 3.700512310892626*^9, {
   3.700512344566741*^9, 3.700512368411099*^9}, {3.700512439413253*^9, 
   3.7005124458794518`*^9}, {3.700513791956541*^9, 3.7005138214218082`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{"pointList", ",", "gradList", ",", "preList", ",", "lossList"}], 
    "]"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"takes", " ", "loss"}], ",", " ", "grad", ",", " ", 
    RowBox[{"learning", " ", "rate"}], ",", " ", 
    RowBox[{"produces", " ", "list", " ", "of", " ", "losses"}]}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"globals", ":", " ", "points"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"optimizeSGD", "[", 
    RowBox[{"lr_", ",", "w0f_", ",", "iters_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "wf", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pointList", ",", " ", "gradList", ",", "preList", ",", " ", 
         "lossList"}], "}"}], "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", "}"}], ",", 
         RowBox[{"{", "}"}], ",", 
         RowBox[{"{", "}"}], ",", 
         RowBox[{"{", "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wf", "=", "w0f"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"iter", "=", "1"}], ",", 
        RowBox[{"iter", "\[LessEqual]", "iters"}], ",", 
        RowBox[{"iter", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"pointList", "=", 
          RowBox[{"pointList", "~", "Append", "~", "wf"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"gradList", "=", 
          RowBox[{"gradList", "~", "Append", "~", 
           RowBox[{"gradf", "[", "wf", "]"}]}]}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"preList", "=", 
          RowBox[{"preList", "~", "Append", "~", 
           RowBox[{"ihessf", "[", "wf", "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"lossList", "=", 
          RowBox[{"lossList", "~", "Append", "~", 
           RowBox[{"lossf", "[", "wf", "]"}]}]}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"wf", "=", 
          RowBox[{"wf", "-", 
           RowBox[{"lr", "*", 
            RowBox[{"gradf", "[", "wf", "]"}]}]}]}]}]}], 
       "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"optimizeSGD", "[", 
   RowBox[{"1.", ",", "W0f", ",", "200"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
   "\"\<~/git/whitening/exp/data/rotations_simple_losses_sgd.csv\>\"", ",", 
    "lossList"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"ListPlot", "[", "lossList", "]"}]}], "Input",
 CellChangeTimes->{
  3.70049446462529*^9, {3.7004998809956512`*^9, 3.700499891997757*^9}, {
   3.700511334296687*^9, 3.7005113741441174`*^9}, {3.700511426888898*^9, 
   3.700511431306085*^9}}],

Cell[BoxData[
 GraphicsBox[{{}, {{}, 
    {RGBColor[0.368417, 0.506779, 0.709798], PointSize[0.009166666666666668], 
     AbsoluteThickness[1.6], PointBox[CompressedData["
1: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
BxtQkeY=
      "]]}, {}}, {}, {}, {{}, {}}},
  AspectRatio->NCache[GoldenRatio^(-1), 0.6180339887498948],
  Axes->{True, True},
  AxesLabel->{None, None},
  AxesOrigin->{0., 0},
  DisplayFunction->Identity,
  Frame->{{False, False}, {False, False}},
  FrameLabel->{{None, None}, {None, None}},
  FrameTicks->{{Automatic, Automatic}, {Automatic, Automatic}},
  GridLines->{None, None},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImagePadding->All,
  Method->{"CoordinatesToolOptions" -> {"DisplayFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& ), "CopiedValueFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& )}},
  PlotRange->{{0., 200.}, {0, 0.008266420533055457}},
  PlotRangeClipping->True,
  PlotRangePadding->{{
     Scaled[0.02], 
     Scaled[0.02]}, {
     Scaled[0.02], 
     Scaled[0.05]}},
  Ticks->{Automatic, Automatic}]], "Output",
 CellChangeTimes->{
  3.700494468096017*^9, {3.700499882129221*^9, 3.700499892326291*^9}, {
   3.700511330424659*^9, 3.700511345659562*^9}, {3.700511380154088*^9, 
   3.700511387676446*^9}, 3.700511432033964*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Simple2 Newton", "Section",
 CellChangeTimes->{{3.700500825448949*^9, 3.7005008285120277`*^9}, {
  3.7005009583096437`*^9, 3.700500958915991*^9}, {3.700511229659986*^9, 
  3.700511230941443*^9}, {3.700511922990353*^9, 3.7005119375696297`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", 
   RowBox[{
   "A", ",", "B", ",", "Bn", ",", "dW", ",", "W", ",", "X", ",", "Y", ",", 
    "y", ",", "x", ",", "fs", ",", " ", "subW", ",", "loss", ",", "err"}], 
   "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fs", "=", 
   RowBox[{"{", 
    RowBox[{"10", ",", "2", ",", "2", ",", "2"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Export", "[", 
    RowBox[{
    "\"\<~/git/whitening/exp/data/rotations_simple2_fs.csv\>\"", ",", "fs"}], 
    "]"}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"X0", "=", 
   RowBox[{"generateX", "[", 
    RowBox[{
     RowBox[{"fs", "[", 
      RowBox[{"[", "2", "]"}], "]"}], ",", "0.01", ",", 
     RowBox[{"fs", "[", 
      RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Export", "[", 
    RowBox[{
    "\"\<~/git/whitening/exp/data/rotations_simple2_X0.csv\>\"", ",", "X0"}], 
    "]"}], ";", 
   RowBox[{"ListPlot", "[", 
    RowBox[{
     RowBox[{"Transpose", "@", "X0"}], ",", 
     RowBox[{"AspectRatio", "\[Rule]", "1"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"X", "=", 
   RowBox[{"Array", "[", 
    RowBox[{
     RowBox[{"W", "[", "0", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"fs", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{"fs", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "X", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"subX", ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Assert", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Dimensions", "[", "X0", "]"}], "\[Equal]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"fs", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", 
           RowBox[{"fs", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], ",", 
        "\"\<X mismatch\>\""}], "]"}], ";", 
      RowBox[{"Thread", "[", 
       RowBox[{
        RowBox[{"Flatten", "@", "X"}], "\[Rule]", 
        RowBox[{"Flatten", "@", "X0"}]}], "]"}]}], "\[IndentingNewLine]", 
     ")"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dsize", "=", 
   RowBox[{"First", "@", "fs"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"n", "=", 
    RowBox[{
     RowBox[{"Length", "[", "fs", "]"}], "-", "2"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makeW", "[", "k_", "]"}], ":=", 
   RowBox[{"Array", "[", 
    RowBox[{
     RowBox[{"W", "[", "k", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"fs", "[", 
        RowBox[{"[", 
         RowBox[{"k", "+", "2"}], "]"}], "]"}], ",", 
       RowBox[{"fs", "[", 
        RowBox[{"[", 
         RowBox[{"k", "+", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"makeInitializer", "[", "k_", "]"}], ":=", 
    RowBox[{"RandomReal", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"fs", "[", 
         RowBox[{"[", 
          RowBox[{"k", "+", "2"}], "]"}], "]"}], ",", 
        RowBox[{"fs", "[", 
         RowBox[{"[", 
          RowBox[{"k", "+", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vars", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"makeW", "[", "k", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", "n"}], "}"}]}], "]"}]}], ";", " ", 
  RowBox[{"(*", " ", 
   RowBox[{"W1", ",", " ", "W2", ",", " ", "...", ",", " ", "Wn"}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"varsf", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"vectorize", "/@", "vars"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Ws", "=", "vars"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Wf", "=", "varsf"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"subW", "[", "Wf0_", "]"}], ":=", 
   RowBox[{"Thread", "[", 
    RowBox[{"Wf", "\[Rule]", "Wf0"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"W0", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"makeInitializer", "[", "k", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", "n"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"W0f", "=", 
    RowBox[{"Flatten", "[", 
     RowBox[{"vectorize", "/@", "W0"}], "]"}]}], ";"}], "\[IndentingNewLine]",
   "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"W0", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"makeInitializer", "[", "k", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", "n"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"errEq", ":=", 
   RowBox[{"X", "-", 
    RowBox[{
     RowBox[{"Fold", "[", 
      RowBox[{"Dot", ",", 
       RowBox[{"Reverse", "@", "vars"}]}], "]"}], ".", "X"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"lossEq", ":=", 
    RowBox[{
     RowBox[{"Tr", "[", 
      RowBox[{"errEq", ".", 
       RowBox[{"errEq", "\[Transpose]"}]}], "]"}], "/", "2"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"A", "[", "i", "]"}], "=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"W", "[", 
        RowBox[{"i", "-", "1"}], "]"}], "..."}], 
      RowBox[{"W", "[", "0", "]"}]}], " ", "=", " ", 
     RowBox[{
     "fprop", " ", "needed", " ", "to", " ", "compute", " ", "derivative", 
      " ", "at", " ", "layer", " ", "i"}]}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"A", "[", 
    RowBox[{"Wf_", ",", "1"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"makeW", "[", "0", "]"}], "/.", "subX"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"A", "[", 
     RowBox[{"Wf_", ",", "i_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"makeW", "[", 
         RowBox[{"i", "-", "1"}], "]"}], ".", 
        RowBox[{"A", "[", 
         RowBox[{"Wf", ",", 
          RowBox[{"i", "-", "1"}]}], "]"}]}], "/.", 
       RowBox[{"subW", "[", "Wf", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"B", "[", "i", "]"}], "=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"W", "[", 
         RowBox[{"i", "+", "1"}], "]"}], "'"}], "..."}], "d", 
      RowBox[{"(", "err", ")"}]}], " ", "=", " ", 
     RowBox[{
     "bprop", " ", "needed", " ", "to", " ", "compute", " ", "derivative", 
      " ", "at", " ", "layer", " ", "i"}]}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Bn", "[", "i", "]"}], "=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"W", "[", 
         RowBox[{"i", "+", "1"}], "]"}], "'"}], "..."}], "Identity"}], " ", 
     "=", " ", 
     RowBox[{"partial", " ", "bprop", " ", "needed", " ", "for", " ", 
      RowBox[{"Newton", "'"}], "s", " ", "method"}]}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"err", "[", "Wf_", "]"}], ":=", 
   RowBox[{
    RowBox[{"errEq", "/.", 
     RowBox[{"subW", "[", "Wf", "]"}]}], "/.", "subX"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"B", "[", 
    RowBox[{"Wf_", ",", "n"}], "]"}], ":=", 
   RowBox[{"-", 
    RowBox[{"err", "[", "Wf", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"B", "[", 
    RowBox[{"Wf_", ",", "i_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"makeW", "[", 
       RowBox[{"i", "+", "1"}], "]"}], "\[Transpose]"}], ".", 
     RowBox[{"B", "[", 
      RowBox[{"Wf", ",", 
       RowBox[{"i", "+", "1"}]}], "]"}]}], "/.", 
    RowBox[{"subW", "[", "Wf", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Bn", "[", 
    RowBox[{"Wf_", ",", "n"}], "]"}], ":=", 
   RowBox[{"IdentityMatrix", "[", 
    RowBox[{"Last", "@", "fs"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Bn", "[", 
     RowBox[{"Wf_", ",", "i_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"makeW", "[", 
        RowBox[{"i", "+", "1"}], "]"}], "\[Transpose]"}], ".", 
      RowBox[{"Bn", "[", 
       RowBox[{"Wf", ",", 
        RowBox[{"i", "+", "1"}]}], "]"}]}], "/.", 
     RowBox[{"subW", "[", "Wf", "]"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"dW", "[", 
     RowBox[{"Wf_", ",", "i_"}], "]"}], ":=", 
    RowBox[{"-", 
     RowBox[{
      RowBox[{"B", "[", 
       RowBox[{"Wf", ",", "i"}], "]"}], ".", 
      RowBox[{
       RowBox[{"A", "[", 
        RowBox[{"Wf", ",", "i"}], "]"}], "\[Transpose]"}]}]}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Define", " ", "loss"}], ",", " ", "gradient", ",", " ", 
    "Hessian"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"lossf", "[", "Wf_", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"lossEq", "/.", 
      RowBox[{"subW", "[", "Wf", "]"}]}], "/.", "subX"}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"loss", "[", "Ws_", "]"}], ":=", 
    RowBox[{"lossf", "[", 
     RowBox[{"flatten", "[", "Ws", "]"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gradEq", "=", 
   RowBox[{"D", "[", 
    RowBox[{
     RowBox[{"lossf", "[", "Wf", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"Wf", ",", "1"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hessEq", "=", 
   RowBox[{"D", "[", 
    RowBox[{
     RowBox[{"lossf", "[", "Wf", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"Wf", ",", "2"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"gradf", "[", "Wf_", "]"}], ":=", 
   RowBox[{"gradEq", "/.", 
    RowBox[{"subW", "[", "Wf", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"hessf", "[", "Wf_", "]"}], ":=", 
   RowBox[{"hessEq", "/.", 
    RowBox[{"subW", "[", "Wf", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"hessBlock", "[", 
    RowBox[{"W0f_", ",", "i_"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"D", "[", 
     RowBox[{
      RowBox[{"lossf", "[", "Wf", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"c2v", "@", 
         RowBox[{"vectorize", "@", 
          RowBox[{"Ws", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}]}], ",", "2"}], "}"}]}], "]"}], "/.", 
    RowBox[{"subW", "[", "W0f", "]"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ihessf", "[", "Wf_", "]"}], ":=", 
    RowBox[{"PseudoInverse", "[", 
     RowBox[{"hessf", "[", "Wf", "]"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Assert", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"hessBlock", "[", 
      RowBox[{"W0f", ",", "1"}], "]"}], "==", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"A", "[", 
         RowBox[{"W0f", ",", "1"}], "]"}], ".", 
        RowBox[{
         RowBox[{"A", "[", 
          RowBox[{"W0f", ",", "1"}], "]"}], "\[Transpose]"}]}], ")"}], 
      "\[TensorProduct]", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Bn", "[", 
         RowBox[{"W0f", ",", "1"}], "]"}], ".", 
        RowBox[{
         RowBox[{"Bn", "[", 
          RowBox[{"W0f", ",", "1"}], "]"}], "\[Transpose]"}]}], ")"}]}]}], 
    ",", "\"\<hess check\>\""}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Assert", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"hessBlock", "[", 
       RowBox[{"W0f", ",", "2"}], "]"}], "==", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"A", "[", 
          RowBox[{"W0f", ",", "2"}], "]"}], ".", 
         RowBox[{
          RowBox[{"A", "[", 
           RowBox[{"W0f", ",", "2"}], "]"}], "\[Transpose]"}]}], ")"}], 
       "\[TensorProduct]", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Bn", "[", 
          RowBox[{"W0f", ",", "2"}], "]"}], ".", 
         RowBox[{
          RowBox[{"Bn", "[", 
           RowBox[{"W0f", ",", "2"}], "]"}], "\[Transpose]"}]}], ")"}]}]}], 
     ",", "\"\<hess check\>\""}], "]"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
   "\"\<~/git/whitening/exp/data/rotations_simple2_W0f.csv\>\"", ",", "W0f"}],
    "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
   "\"\<~/git/whitening/exp/data/rotations_simple2_fs.csv\>\"", ",", "fs"}], 
   "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{"\"\<~/git/whitening/exp/data/rotations_simple2_hess.csv\>\"", ",", 
    RowBox[{"hessf", "[", "W0f", "]"}]}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.700492290056683*^9, 3.7004923142113943`*^9}, {
   3.7004926930567503`*^9, 3.700492752669366*^9}, {3.7004927894353952`*^9, 
   3.700492835616544*^9}, {3.7004929292190104`*^9, 3.700492930578763*^9}, {
   3.7004929807654133`*^9, 3.700493053293647*^9}, {3.700493120976757*^9, 
   3.7004931275102386`*^9}, {3.700493178969997*^9, 3.700493199162386*^9}, {
   3.700493261476766*^9, 3.700493290883313*^9}, {3.7004934897416267`*^9, 
   3.7004935398593607`*^9}, {3.700493570213716*^9, 3.700493615168483*^9}, {
   3.700493829212441*^9, 3.700493830835346*^9}, {3.7004941196561947`*^9, 
   3.700494188998247*^9}, {3.700494261653702*^9, 3.70049437413951*^9}, {
   3.700501027105609*^9, 3.700501042977265*^9}, {3.7005021382266617`*^9, 
   3.700502205352611*^9}, {3.7005025233733997`*^9, 3.700502539630456*^9}, {
   3.700502670850354*^9, 3.7005026710402403`*^9}, {3.700502723028463*^9, 
   3.700502736413529*^9}, 3.7005027703789787`*^9, {3.7005040381932583`*^9, 
   3.700504038371191*^9}, {3.700504083294283*^9, 3.7005041281528273`*^9}, {
   3.7005051654131403`*^9, 3.700505177797332*^9}, {3.700511931338737*^9, 
   3.7005119749656353`*^9}, {3.700512429435474*^9, 3.70051242975*^9}, {
   3.700512627158106*^9, 3.700512660906281*^9}, {3.700513308088587*^9, 
   3.700513308334346*^9}, {3.700519949531604*^9, 3.700519956202489*^9}, {
   3.700520014297574*^9, 3.70052009408463*^9}, {3.70052016076511*^9, 
   3.700520161684248*^9}, {3.700521179389061*^9, 3.700521201337274*^9}, {
   3.700521480991094*^9, 3.700521481989676*^9}, 3.700521542494562*^9, {
   3.700521801660325*^9, 3.700521814149651*^9}, {3.700521946956933*^9, 
   3.700521965428814*^9}, {3.700522344783354*^9, 3.7005223778237333`*^9}, {
   3.700522515320136*^9, 3.7005225199667683`*^9}, {3.700522825181044*^9, 
   3.700522847657449*^9}, {3.700523078632535*^9, 3.7005230822567663`*^9}}],

Cell[BoxData[
 TemplateBox[{
  "Clear","wrsym","\"Symbol \\!\\(\\*RowBox[{\\\"X\\\"}]\\) is Protected.\"",
   2,1092,73,32444777529035783539,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.700522848955068*^9}],

Cell[BoxData[
 GraphicsBox[{{}, {{}, 
    {RGBColor[0.368417, 0.506779, 0.709798], PointSize[0.012833333333333334`],
      AbsoluteThickness[1.6], 
     PointBox[{{-0.3102786308231701, -0.3082884234589587}, \
{-0.489509423027745, -0.43889149084258494`}, {0.6711587016989475, 
      0.7523715157765822}, {-0.7899811490193063, -0.8681556915468173}, \
{-0.9973617491008218, -1.131008008135098}, {1.056738323768034, 
      0.8929235084266067}, {0.025607656205254514`, 0.07216975113108515}, {
      0.3690759667734618, 0.24423812998720595`}, {0.8185447558759188, 
      0.914657933360546}, {-0.35399445235057303`, -0.13001722469856714`}}]}, \
{}}, {}, {}, {{}, {}}},
  AspectRatio->1,
  Axes->{True, True},
  AxesLabel->{None, None},
  AxesOrigin->{0, 0},
  DisplayFunction->Identity,
  Frame->{{False, False}, {False, False}},
  FrameLabel->{{None, None}, {None, None}},
  FrameTicks->{{Automatic, Automatic}, {Automatic, Automatic}},
  GridLines->{None, None},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImagePadding->All,
  Method->{"CoordinatesToolOptions" -> {"DisplayFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& ), "CopiedValueFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& )}},
  PlotRange->{{-0.9973617491008218, 1.056738323768034}, {-1.131008008135098, 
   0.914657933360546}},
  PlotRangeClipping->True,
  PlotRangePadding->{{
     Scaled[0.02], 
     Scaled[0.02]}, {
     Scaled[0.05], 
     Scaled[0.05]}},
  Ticks->{Automatic, Automatic}]], "Output",
 CellChangeTimes->{
  3.700504128977111*^9, 3.70050517843817*^9, 3.700511325109571*^9, 
   3.700511383514359*^9, 3.7005124614714403`*^9, {3.7005126281984053`*^9, 
   3.700512661413319*^9}, 3.700513308854253*^9, 3.700513691248931*^9, 
   3.7005144433964977`*^9, 3.700516115811862*^9, {3.700516686289905*^9, 
   3.7005166981359577`*^9}, 3.700517629597433*^9, 3.700517843560604*^9, 
   3.700517990911737*^9, 3.700518109668104*^9, 3.700519958271717*^9, 
   3.700520047188774*^9, 3.700520100374611*^9, {3.7005201490132437`*^9, 
   3.7005201673714333`*^9}, 3.700520204893095*^9, 3.700520817975306*^9, 
   3.700520876948984*^9, {3.700521189930863*^9, 3.7005212023846197`*^9}, 
   3.700521486534465*^9, 3.700521543751587*^9, 3.70052181927234*^9, 
   3.700521920688792*^9, 3.700522034736763*^9, 3.70052238959762*^9, 
   3.7005225238379908`*^9, 3.700522849108197*^9}],

Cell[BoxData[
 TemplateBox[{
  "Set","wrsym","\"Symbol \\!\\(\\*RowBox[{\\\"X\\\"}]\\) is Protected.\"",2,
   1097,74,32444777529035783539,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.700522849129963*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{"pointList", ",", "gradList", ",", "preList", ",", "lossList"}], 
    "]"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"takes", " ", "loss"}], ",", " ", "grad", ",", " ", 
    RowBox[{"learning", " ", "rate"}], ",", " ", 
    RowBox[{"produces", " ", "list", " ", "of", " ", "losses"}]}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"globals", ":", " ", "points"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"optimizeNewton", "[", 
    RowBox[{"lr_", ",", "w0f_", ",", "iters_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "wf", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pointList", ",", " ", "gradList", ",", "preList", ",", " ", 
         "lossList"}], "}"}], "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", "}"}], ",", 
         RowBox[{"{", "}"}], ",", 
         RowBox[{"{", "}"}], ",", 
         RowBox[{"{", "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wf", "=", "w0f"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"iter", "=", "1"}], ",", 
        RowBox[{"iter", "\[LessEqual]", "iters"}], ",", 
        RowBox[{"iter", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"pointList", "=", 
          RowBox[{"pointList", "~", "Append", "~", "wf"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"gradList", "=", 
          RowBox[{"gradList", "~", "Append", "~", 
           RowBox[{"gradf", "[", "wf", "]"}]}]}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"preList", "=", 
          RowBox[{"preList", "~", "Append", "~", 
           RowBox[{"ihessf", "[", "wf", "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"lossList", "=", 
          RowBox[{"lossList", "~", "Append", "~", 
           RowBox[{"lossf", "[", "wf", "]"}]}]}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"wf", "=", 
          RowBox[{"wf", "-", 
           RowBox[{"lr", "*", 
            RowBox[{
             RowBox[{"ihessf", "[", "wf", "]"}], ".", 
             RowBox[{"gradf", "[", "wf", "]"}]}]}]}]}]}]}], 
       "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"optimizeNewton", "[", 
   RowBox[{"1.", ",", "W0f", ",", "100"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
   "\"\<~/git/whitening/exp/data/rotations_simple2_losses_newton.csv\>\"", 
    ",", "lossList"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"ListPlot", "[", 
  RowBox[{"lossList", ",", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.700499901323206*^9, 3.700499906789361*^9}, {
  3.7005050617196417`*^9, 3.7005050982685003`*^9}, {3.700511353299275*^9, 
  3.700511354096363*^9}, {3.700511981020671*^9, 3.70051198258181*^9}, {
  3.700512686025956*^9, 3.70051268649797*^9}, {3.7005127981899843`*^9, 
  3.7005128265207357`*^9}, {3.700513299368472*^9, 3.7005133012796383`*^9}}],

Cell[BoxData[
 GraphicsBox[{{}, {{}, 
    {RGBColor[0.368417, 0.506779, 0.709798], PointSize[0.009166666666666668], 
     AbsoluteThickness[1.6], PointBox[CompressedData["
1:eJxdkr0vQ1EYh0/EYOxgEJEoERFp6ptS9C3VVrXa3n5apSYVZtNZrcxI/AMS
X924kUj8AXYSA4tEYmJC3DTep8lN89zn/M7vvfeenvVtZ6PFGFP7uX7//37v
kZO9LfG/3Ee8G9J4Owp8HB943Cav3YfX9fCOxz7pfB768oXqHrdL6+nd/u3D
pscdsvsU/LxpcpdcPP5nv5wr7oXvk0vF/XKmeADrB+EDyAexfhg8Ah5Ffgx+
HDyB/kn4KWkoDsFPo28G+4XBs3KleA5+Hj6C/UX3W4GPwkfhF3SfBZtF5MEm
pr+/jcEv6fkt2MTRH0c+AZ+AT2K+JM7jMjzYpLB/Cn4FebBJ6/dp0/AZ5DM4
P6vwYJPFfFn4nGbJYT28CzZ5PY/kkYd388g7+vnFQd5BP9gUMD/Ygt0Czm8R
+SK+B7wLNiXkS5gf3i2hv4w82Jbx/uBNBfkK+uFdsKnq9VJFP9it4vytNfPf
5ik3CA==
      "]]}, {}}, {}, {}, {{}, {}}},
  AspectRatio->NCache[GoldenRatio^(-1), 0.6180339887498948],
  Axes->{True, True},
  AxesLabel->{None, None},
  AxesOrigin->{0, 0},
  DisplayFunction->Identity,
  Frame->{{False, False}, {False, False}},
  FrameLabel->{{None, None}, {None, None}},
  FrameTicks->{{Automatic, Automatic}, {Automatic, Automatic}},
  GridLines->{None, None},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImagePadding->All,
  Method->{"CoordinatesToolOptions" -> {"DisplayFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& ), "CopiedValueFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& )}},
  PlotRange->{{0, 100.}, {0, 0.1945534052457108}},
  PlotRangeClipping->True,
  PlotRangePadding->{{
     Scaled[0.02], 
     Scaled[0.02]}, {
     Scaled[0.02], 
     Scaled[0.05]}},
  Ticks->{Automatic, Automatic}]], "Output",
 CellChangeTimes->{
  3.700494451743908*^9, {3.700499895475957*^9, 3.700499907118189*^9}, 
   3.7005040435488033`*^9, {3.700505090872525*^9, 3.700505098644865*^9}, 
   3.700511328249392*^9, 3.700511385283004*^9, 3.700512464057639*^9, {
   3.700512631076838*^9, 3.700512690698986*^9}, {3.700512821364694*^9, 
   3.700512843123567*^9}, 3.700513314647614*^9, 3.70051335137995*^9, 
   3.700513564164805*^9, 3.700513695779717*^9, 3.7005200620902243`*^9, 
   3.7005202300510798`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{"pointList", ",", "gradList", ",", "preList", ",", "lossList"}], 
    "]"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"takes", " ", "loss"}], ",", " ", "grad", ",", " ", 
    RowBox[{"learning", " ", "rate"}], ",", " ", 
    RowBox[{"produces", " ", "list", " ", "of", " ", "losses"}]}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"globals", ":", " ", "points"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"optimizeSGD", "[", 
    RowBox[{"lr_", ",", "w0f_", ",", "iters_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "wf", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pointList", ",", " ", "gradList", ",", "preList", ",", " ", 
         "lossList"}], "}"}], "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", "}"}], ",", 
         RowBox[{"{", "}"}], ",", 
         RowBox[{"{", "}"}], ",", 
         RowBox[{"{", "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wf", "=", "w0f"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"iter", "=", "1"}], ",", 
        RowBox[{"iter", "\[LessEqual]", "iters"}], ",", 
        RowBox[{"iter", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"pointList", "=", 
          RowBox[{"pointList", "~", "Append", "~", "wf"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"gradList", "=", 
          RowBox[{"gradList", "~", "Append", "~", 
           RowBox[{"gradf", "[", "wf", "]"}]}]}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"preList", "=", 
          RowBox[{"preList", "~", "Append", "~", 
           RowBox[{"ihessf", "[", "wf", "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"lossList", "=", 
          RowBox[{"lossList", "~", "Append", "~", 
           RowBox[{"lossf", "[", "wf", "]"}]}]}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"wf", "=", 
          RowBox[{"wf", "-", 
           RowBox[{"lr", "*", 
            RowBox[{"gradf", "[", "wf", "]"}]}]}]}]}]}], 
       "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"optimizeSGD", "[", 
   RowBox[{"1.", ",", "W0f", ",", "200"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
   "\"\<~/git/whitening/exp/data/rotations_simple_losses_sgd.csv\>\"", ",", 
    "lossList"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"ListPlot", "[", "lossList", "]"}]}], "Input",
 CellChangeTimes->{
  3.70049446462529*^9, {3.7004998809956512`*^9, 3.700499891997757*^9}, {
   3.700511334296687*^9, 3.7005113741441174`*^9}, {3.700511426888898*^9, 
   3.700511431306085*^9}}],

Cell[BoxData[
 GraphicsBox[{{}, {{}, 
    {RGBColor[0.368417, 0.506779, 0.709798], PointSize[0.009166666666666668], 
     AbsoluteThickness[1.6], PointBox[CompressedData["
1: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
hj2dRg==
      "]]}, {}}, {}, {}, {{}, {}}},
  AspectRatio->NCache[GoldenRatio^(-1), 0.6180339887498948],
  Axes->{True, True},
  AxesLabel->{None, None},
  AxesOrigin->{0., 0},
  DisplayFunction->Identity,
  Frame->{{False, False}, {False, False}},
  FrameLabel->{{None, None}, {None, None}},
  FrameTicks->{{Automatic, Automatic}, {Automatic, Automatic}},
  GridLines->{None, None},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImagePadding->All,
  Method->{"CoordinatesToolOptions" -> {"DisplayFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& ), "CopiedValueFunction" -> ({
        (Part[{{Identity, Identity}, {Identity, Identity}}, 1, 2][#]& )[
         Part[#, 1]], 
        (Part[{{Identity, Identity}, {Identity, Identity}}, 2, 2][#]& )[
         Part[#, 2]]}& )}},
  PlotRange->{{0., 200.}, {0, 0.005157691515760296}},
  PlotRangeClipping->True,
  PlotRangePadding->{{
     Scaled[0.02], 
     Scaled[0.02]}, {
     Scaled[0.02], 
     Scaled[0.05]}},
  Ticks->{Automatic, Automatic}]], "Output",
 CellChangeTimes->{
  3.700494468096017*^9, {3.700499882129221*^9, 3.700499892326291*^9}, {
   3.700511330424659*^9, 3.700511345659562*^9}, {3.700511380154088*^9, 
   3.700511387676446*^9}, 3.700511432033964*^9, 3.7005133377471313`*^9, 
   3.7005135311730833`*^9}]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{816, 1383},
WindowMargins->{{850, Automatic}, {Automatic, 0}},
FrontEndVersion->"11.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (September \
21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 92, 1, 92, "Title"],
Cell[CellGroupData[{
Cell[697, 27, 68, 1, 32, "Input"],
Cell[768, 30, 1055, 28, 35, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1860, 63, 147, 2, 64, "Section"],
Cell[CellGroupData[{
Cell[2032, 69, 30112, 767, 2659, "Code",
 InitializationCell->False],
Cell[32147, 838, 471, 8, 32, "Output"],
Cell[32621, 848, 1023, 24, 74, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[33693, 878, 95, 1, 64, "Section"],
Cell[33791, 881, 5193, 141, 558, "Input"],
Cell[38987, 1024, 365, 5, 32, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[39389, 1034, 100, 1, 64, "Section"],
Cell[39492, 1037, 1732, 48, 222, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[41261, 1090, 106, 1, 64, "Section"],
Cell[CellGroupData[{
Cell[41392, 1095, 106, 1, 44, "Subsection"],
Cell[CellGroupData[{
Cell[41523, 1100, 1485, 36, 201, "Input"],
Cell[43011, 1138, 1895, 43, 234, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[44943, 1186, 104, 1, 32, "Input"],
Cell[45050, 1189, 766, 14, 96, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[45865, 1209, 129, 2, 44, "Subsection"],
Cell[45997, 1213, 686, 20, 54, "Input"],
Cell[CellGroupData[{
Cell[46708, 1237, 1689, 42, 222, "Input"],
Cell[48400, 1281, 1818, 40, 234, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[50255, 1326, 102, 1, 32, "Input"],
Cell[50360, 1329, 435, 9, 58, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[50844, 1344, 128, 1, 44, "Subsection"],
Cell[CellGroupData[{
Cell[50997, 1349, 1095, 31, 96, "Input"],
Cell[52095, 1382, 72, 1, 32, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[52204, 1388, 1079, 26, 180, "Input"],
Cell[53286, 1416, 1703, 39, 240, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[55050, 1462, 200, 3, 64, "Section"],
Cell[CellGroupData[{
Cell[55275, 1469, 3286, 79, 369, "Input"],
Cell[58564, 1550, 2105, 46, 314, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[60706, 1601, 2897, 74, 369, "Input"],
Cell[63606, 1677, 4247, 82, 236, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[67902, 1765, 249, 3, 64, "Section"],
Cell[CellGroupData[{
Cell[68176, 1772, 15364, 452, 1524, "Input"],
Cell[83543, 2226, 233, 5, 24, "Message"],
Cell[83779, 2233, 2655, 54, 374, "Output"],
Cell[86437, 2289, 231, 5, 24, "Message"]
}, Open  ]],
Cell[CellGroupData[{
Cell[86705, 2299, 3217, 79, 369, "Input"],
Cell[89925, 2380, 2312, 50, 241, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[92274, 2435, 2897, 74, 369, "Input"],
Cell[95174, 2511, 4238, 82, 236, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

